!function(){"use strict";angular.module("components",["analysis","auth","files","home","map","settings","survey","visualisations"])}(),function(){"use strict";angular.module("common",["directives","factories","filters","services"])}(),function(){"use strict";angular.module("nativeQDA",["ngRoute","ngSanitize","ngTable","ngAnimate","ui.bootstrap","ui.bootstrap.datepicker","ngFileUpload","ngTagsInput","jp.ng-bs-animated-button","bsLoadingOverlay","color.picker","angular-carousel","common","components"])}(),function(){"use strict";angular.module("analysis",[])}(),function(){"use strict";angular.module("auth",[])}(),function(){"use strict";angular.module("files",[])}(),function(){"use strict";angular.module("home",[])}(),function(){"use strict";angular.module("map",[])}(),function(){"use strict";angular.module("settings",[])}(),function(){"use strict";angular.module("survey",[])}(),function(){"use strict";angular.module("directives",[])}(),function(){"use strict";angular.module("visualisations",[])}(),function(){"use strict";angular.module("factories",[])}(),function(){"use strict";angular.module("filters",[])}(),function(){"use strict";angular.module("services",[])}(),function(){"use strict";angular.module("datasets",[])}(),function(){"use strict";function e(e,t){e.errorOnUnhandledRejections(!0),toastr.options.closeButton=!0,toastr.options.timeOut=3e3,toastr.options.positionClass="toast-top-right",t.debugEnabled&&t.debugEnabled(!0)}e.$inject=["$qProvider","$logProvider"],angular.module("nativeQDA").config(e)}(),function(){"use strict";function e(e,t){e.when("/login",{title:"NativeQDA | Login",templateUrl:"/components/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm",loginRequired:!1}).when("/register",{title:"NativeQDA | Register",templateUrl:"/components/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm",loginRequired:!1}).when("/forgot-password",{title:"NativeQDA | Forgot Password",templateUrl:"/components/auth/forgotPass/forgotPass.view.html",controller:"forgotPassCtrl",controllerAs:"vm",loginRequired:!1}).when("/",{title:"NativeQDA | Home",templateUrl:"/components/home/home.view.html",controller:"homeCtrl",controllerAs:"vm",loginRequired:!0}).when("/analysis",{title:"NativeQDA | Analysis",templateUrl:"/components/analysis/analysis.view.html",controller:"analysisCtrl",controllerAs:"vm",loginRequired:!0}).when("/visualisations/:id",{title:"NativeQDA | Visualisations",templateUrl:"/components/visualisations/visualisations.view.html",controller:"visualisationsCtrl",controllerAs:"vm",loginRequired:!0}).when("/map",{title:"NativeQDA | Map",templateUrl:"/components/map/map.view.html",controller:"mapCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey",{title:"NativeQDA | Surveys",templateUrl:"/components/survey/survey.view.html",controller:"surveyCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey/create",{title:"NativeQDA | Create Survey",templateUrl:"/components/survey/surveyCreate/surveyCreate.view.html",controller:"surveyCreateCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey/view/:accessId",{title:"NativeQDA | View Survey",templateUrl:"/components/survey/surveyView/surveyView.view.html",controller:"surveyViewCtrl",controllerAs:"vm",loginRequired:!0}).when("/complete-survey",{title:"NativeQDA | Complete Survey",templateUrl:"/components/survey/surveyEnterCode/surveyEnterCode.view.html",controller:"surveyEnterCodeCtrl",controllerAs:"vm",loginRequired:!1}).when("/complete-survey/:accessId",{title:"NativeQDA | Complete Survey",templateUrl:"/components/survey/surveyComplete/surveyComplete.view.html",controller:"surveyCompleteCtrl",controllerAs:"vm",loginRequired:!1}).when("/survey/responses/:accessId",{title:"NativeQDA | Survey Responses",templateUrl:"/components/survey/surveyResponseList/surveyResponseList.view.html",controller:"surveyResponseListCtrl",controllerAs:"vm",loginRequired:!0}).when("/survey/responses/:accessId/:responseId",{title:"NativeQDA | Survey Responses",templateUrl:"/components/survey/surveyResponse/surveyResponse.view.html",controller:"surveyResponseCtrl",controllerAs:"vm",loginRequired:!0}).when("/files/upload",{title:"NativeQDA | Upload File",templateUrl:"/components/files/filesUpload/filesUpload.view.html",controller:"filesUploadCtrl",controllerAs:"vm",loginRequired:!0}).when("/files",{title:"NativeQDA | File Browser",templateUrl:"/components/files/filesBrowse/filesBrowse.view.html",controller:"filesBrowseCtrl",controllerAs:"vm",loginRequired:!0}).when("/files/:folder?/:file*",{title:"NativeQDA | File Browser",templateUrl:"/components/files/filesBrowse/filesBrowse.view.html",controller:"filesBrowseCtrl",controllerAs:"vm",loginRequired:!0}).when("/datasets",{title:"NativeQDA | Datasets",templateUrl:"/components/files/datasets/datasets.view.html",controller:"datasetsCtrl",controllerAs:"vm",loginRequired:!0}).when("/settings/system-settings",{title:"NativeQDA | System Settings",templateUrl:"/components/settings/systemSettings/systemSettings.view.html",controller:"systemSettingsCtrl",controllerAs:"vm",loginRequired:!0}).when("/settings/knowledgebase",{title:"NativeQDA | Knowledgebase",templateUrl:"/components/settings/knowledgebase/knowledgebase.view.html",controller:"knowledgebaseCtrl",controllerAs:"vm",loginRequired:!0}).when("/settings/user-management",{title:"NativeQDA | User Management",templateUrl:"/components/settings/userManagement/userManagement.view.html",controller:"userManagementCtrl",controllerAs:"vm",loginRequired:!0}).when("/bubble-chart/:type/:id",{title:"NativeQDA | Bubble Chart",templateUrl:"/components/visualisations/visuals/bubbleChart/bubbleChart.view.html",controller:"bubbleChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/pie-chart/:type/:id",{title:"NativeQDA | Pie Chart",templateUrl:"components/visualisations/visuals/pieChart/pieChart.view.html",controller:"pieChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/donut-chart/:type/:id",{title:"NativeQDA | Donut Chart",templateUrl:"components/visualisations/visuals/donutChart/donutChart.view.html",controller:"donutChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/radar-chart/:type/:id",{title:"NativeQDA | Radar Chart",templateUrl:"/components/visualisations/visuals/radarChart/radarChart.view.html",controller:"radarChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/treemap-chart/:type/:id",{title:"NativeQDA | Treemap Chart",templateUrl:"/components/visualisations/visuals/treemapChart/treemapChart.view.html",controller:"treemapChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/data-table/:type/:id",{title:"NativeQDA | Data Table",templateUrl:"/components/visualisations/visuals/dataTable/dataTable.view.html",controller:"dataTableCtrl",controllerAs:"vm",loginRequired:!0}).when("/bar-chart/:type/:id",{title:"NativeQDA | Bar Chart",templateUrl:"/components/visualisations/visuals/barChart/barChart.view.html",controller:"barChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/word-cloud/:type/:id",{title:"NativeQDA | Word Cloud",templateUrl:"/components/visualisations/visuals/wordCloud/wordCloud.view.html",controller:"wordCloudCtrl",controllerAs:"vm",loginRequired:!0}).when("/network-chart/:type/:id",{title:"NativeQDA | Network Chart",templateUrl:"/components/visualisations/visuals/networkChart/networkChart.view.html",controller:"networkChartCtrl",controllerAs:"vm",loginRequired:!0}).when("/heatmap-example",{title:"NativeQDA | Heatmap Example",templateUrl:"/components/heatmapExample/heatmapExample.view.html",controller:"heatmapCtrl",controllerAs:"vm",loginRequired:!0}).when("/test-analysis/aylien",{title:"NativeQDA | Test Analysis - AYLIEN",templateUrl:"/components/testAnalysis/aylien/testAylien.view.html",controller:"testAylienCtrl",controllerAs:"vm",loginRequired:!0}).when("/test-analysis/watson",{title:"NativeQDA | Test Analysis - Watson",templateUrl:"/components/testAnalysis/watson/testWatson.view.html",controller:"testWatsonCtrl",controllerAs:"vm",loginRequired:!0}).when("/reset-password/:token",{title:"NativeQDA | Reset Password",templateUrl:"/components/auth/resetPassword/resetPassword.view.html",controller:"resetPasswordCtrl",controllerAs:"vm",loginRequired:!1}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}e.$inject=["$routeProvider","$locationProvider"],angular.module("nativeQDA").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authService","bsLoadingOverlayService",function(e,t,n,a){e.$on("$routeChangeStart",function(e,a,r){var o;a.loginRequired&&!n.isLoggedIn()?(o=t.path(),t.path("/login").replace(),t.search("page",o)):a.loginRequired&&n.isLoggedIn()&&(n.checkJWT(),t.path(o).replace(),o=null)}),e.$on("$routeChangeSuccess",function(t,n,a){n.$$route.title?e.title=n.$$route.title:e.title="NativeQDA"}),a.setGlobalConfig({templateUrl:"/common/views/loadingOverlayTemplate4.html",delay:300})}])}(),function(){function e(e,t,n,a,r,o){function i(){return a.listWatsonAnalysis().then(function(e){return u.analyses=e,u.analyses},function(e){r.stop({referenceId:"analysis-list"})})}function s(){u.tableParams=new t({sorting:{dateCreated:"desc"}},{dataset:u.analyses}),r.stop({referenceId:"analysis-list"})}function l(e,t){a.deleteWatsonAnalysis(t).then(function(){c(t),o.success("'"+e+"' was deleted successfully","","Success")})}function c(e){var t=u.analyses.findIndex(function(t){return t._id==e});t>-1&&u.analyses.splice(t,1),s()}var u=this;u.getAnalysesList=i,u.confirmDelete=function(e,t){swal({title:"Are you sure?",text:"Confirm to delete the analysis '"+e+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){l(e,t)})},u.popupNewAnalysis=function(){n.open({templateUrl:"/components/analysis/newAnalysis/newAnalysis.view.html",controller:"newAnalysisCtrl as vm",size:"xl"}).result.then(function(e){u.analyses.push(e),s()})},u.goToVisUrl=function(t){e.path("visualisations/"+t)},u.analyses=[],u.pageHeader={title:"Analysis",strapline:"where the magic happens"},r.start({referenceId:"analysis-list"}),i().then(function(){s()})}e.$inject=["$location","NgTableParams","$uibModal","analysisService","bsLoadingOverlayService","logger"],angular.module("analysis").controller("analysisCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o,i,s,l,c,u,d,p){function f(){var e={center:[-34.4054039,150.87842999999998],zoom:4};P.map=L.map("map-homepage",e);var t="pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:t,maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:t,maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:t,maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:t,maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:t,maxZoom:22}),s=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:t,maxZoom:22}).addTo(P.map),l=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:t,maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:t,maxZoom:22})),c=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:t,maxZoom:22}),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:t,maxZoom:22}),d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:t,maxZoom:22}),p=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:t,maxZoom:22}),f=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:t,maxZoom:22}),g=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),h=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),y=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),b=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),w=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});w.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":n,"Mapbox Dark":a,"Mapbox Satellite":r,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":i,"Mapbox Streets Basic":s,"Mapbox Outdoors":l,"Mapbox Run Bike Hike":c,"Mapbox Pencil":u,"Mapbox Pirates":d,"Mapbox Emerald":p,"Mapbox High Contrast":f,"Google Roadmap":g,"Google Aerial":h,"Google Terrain":y,"Google Hybrid":b,"Google Traffic":w},{},{collapsed:!0}).addTo(P.map),P.posMarker=L.marker([P.lat,P.lng],{icon:R,zIndexOffset:-500}).bindTooltip("<strong>Your Position</strong>"),m(),v()}function m(){P.map.on("locationfound",g),P.map.on("locationerror",h),P.map.locate({setView:!0,maxZoom:15})}function g(e){var n=e.accuracy/2,a=e.latlng;P.posMarker.setLatLng(a),P.posMarker.bindPopup("<p style='margin: 5px !important;padding-top:8px;'>You are within "+t("formatDistance")(n)+" of this point</p>",{closeButton:!1}),P.posMarker.addTo(P.map);var r=L.circle(a,{radius:n,color:"#cb2529"});P.posMarker.on("popupopen",function(){r.addTo(P.map),P.map.fitBounds(r.getBounds())}),P.posMarker.on("popupclose",function(){P.map.removeLayer(r)})}function h(e){p.error(e.message,e,"Error")}function v(){s.getFileList().then(function(e){P.fileList=e,k(),x(),y()},function(e){i.stop({referenceId:"file-list"}),i.stop({referenceId:"home-map"})})}function y(){d.listWatsonAnalysis().then(function(e){P.analysisList=e,b()})}function b(){var e=null,t=null;P.analysisList.forEach(function(n,a){0==a?(e=n.dateCreated,t=n.dateCreated):(e>n.dateCreated&&(e=n.dateCreated),t<n.dateCreated&&(t=n.dateCreated))}),P.fileList.forEach(function(n){e>n.dateCreated&&(e=n.dateCreated),t<n.dateCreated&&(t=n.dateCreated)}),e=e.substring(0,10),t=t.substring(0,10);for(var n=[{date:e,fileCount:0,analysisCount:0},{date:t,fileCount:0,analysisCount:0}],a=moment(n[0].date),r=moment(n[1].date).diff(a,"d",!1),o=1;o<r;o++)n.splice(o,0,{date:a.add(1,"d").toISOString().substring(0,10),fileCount:0,analysisCount:0});P.fileList.forEach(function(e,t){for(var a=0;a<n.length;a++)if(n[a].date==e.dateCreated.substring(0,10)){n[a].fileCount++;break}}),P.analysisList.forEach(function(e,t){for(var a=0;a<n.length;a++)if(n[a].date==e.dateCreated.substring(0,10)){n[a].analysisCount++;break}}),w(n)}function w(e){var t={top:20,right:20,bottom:30,left:50},n=document.querySelector("#dateGraph").clientWidth-t.left-t.right,a=300-t.top-t.bottom,r=d3.timeParse("%Y-%m-%d"),o=d3.scaleTime().range([0,n]),i=d3.scaleLinear().range([a,0]),s=d3.line().x(function(e){return o(e.date)}).y(function(e){return i(e.files)}),l=d3.line().x(function(e){return o(e.date)}).y(function(e){return i(e.analyses)}),c=d3.select("#dateGraph").append("svg").attr("width",n+t.left+t.right).attr("height",a+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")"),u=[{name:"Files"},{name:"Analyses"}],d=c.selectAll("g").data(u).enter().append("g").attr("class","legend");d.append("rect").attr("x",n-60).attr("y",function(e,t){return 20*t}).attr("width",10).attr("height",10).style("fill",function(e){return"Files"==e.name?"green":"blue"}),d.append("text").attr("x",n-45).attr("y",function(e,t){return 20*t+9}).text(function(e){return e.name}),e.forEach(function(e){e.date=r(e.date),e.files=e.fileCount,e.analyses=e.analysisCount}),o.domain(d3.extent(e,function(e){return e.date})),i.domain([0,d3.max(e,function(e){return Math.max(e.files,e.analyses)})]),c.append("path").data([e]).attr("class","line").style("stroke","green").attr("d",s),c.append("path").data([e]).attr("class","line").style("stroke","blue").attr("d",l),c.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(d3.axisBottom(o)),c.append("g").attr("class","y axis").call(d3.axisLeft(i));var p=c.append("g").attr("class","mouse-over-effects");p.append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0");var f=document.getElementsByClassName("line"),m=p.selectAll(".mouse-per-line").data(u).enter().append("g").attr("class","mouse-per-line");m.append("circle").attr("r",7).style("stroke",function(e){return"Files"==e.name?"green":"blue"}).style("fill","none").style("stroke-width","1px").style("opacity","0"),m.append("text"),p.append("svg:rect").attr("width",n).attr("height",a).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0")}).on("mouseover",function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1")}).on("mousemove",function(){var e=d3.mouse(this);d3.select(".mouse-line").attr("d",function(){var t="M"+e[0]+","+a;return t+=" "+e[0]+",0"}),d3.selectAll(".mouse-per-line").attr("transform",function(t,a){o.invert(e[0]),d3.bisector(function(e){return e.date}).right;for(var r=0,s=f[a].getTotalLength(),l=null;;){l=Math.floor((r+s)/2);var c=f[a].getPointAtLength(l);if((l===s||l===r)&&c.x!==e[0])break;if(c.x>e[0])s=l;else{if(!(c.x<e[0]))break;r=l}}return d3.select(this).select("text").text(function(e){return"Files"==e.name?"Files Uploaded: "+i.invert(c.y).toFixed(0):"Analyses Processed: "+i.invert(c.y).toFixed(0)}).attr("transform",function(t){return n/e[0]<2?"Files"==t.name?"translate(-120,-5)":"translate(-155,-25)":"Files"==t.name?"translate(10,-5)":"translate(10,-25)"}),"translate("+e[0]+","+c.y+")"})})}function x(){P.markers=L.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:40}),P.fileList.forEach(function(a,r,o){var i,s=a.coords.coordinates[1],l=a.coords.coordinates[0];switch(a.type){case"file":i=L.marker([s,l],{icon:B});break;case"text":i=L.marker([s,l],{icon:z});break;case"doc":i=L.marker([s,l],{icon:U});break;case"pdf":i=L.marker([s,l],{icon:$});break;case"image":i=L.marker([s,l],{icon:O});break;case"video":i=L.marker([s,l],{icon:N});break;case"audio":i=L.marker([s,l],{icon:E});break;default:i=L.marker([s,l],{icon:D})}var c='<div class="info-window"><div style="background-color:#4676fa;border-radius: 12px 12px 0 0 !important;text-align:center;"><h3 style="color:#FFF;margin-left:8px;margin-right:5px;padding-bottom:5px;padding-top:5px;padding-right:18px;">'+a.name+'</h3></div><div style="margin-left: 15px;margin-right:15px;margin-top:5px;margin-bottom:15px;"><p><strong>Created By:</strong> '+a.createdBy+"<br /><strong>Size:</strong> "+t("formatFileSize")(a.size,2)+"<br /><strong>Last Modified:</strong> "+t("date")(a.lastModified,"dd MMMM, yyyy h:mm a");0!=a.tags.length?(c+="<br /><strong>Tags:</strong> ",c+=a.tags.join(", ")+"</p>"):c+="</p>",c+='<div style="padding-bottom:10px;"></div><div style="text-align:center;"><a ng-click="vm.viewFile(file)" class="btn btn-success btn-xs" role="button">View</a> <a ng-click="vm.popupFileDetails(file)" class="btn btn-primary btn-xs" role="button">Details</a> </div></div>';var u=n(angular.element(c)),d=e.$new();if(d.file={name:a.name,path:a.path,key:a.key,textFileKey:a.textFileKey},i.bindPopup(u(d)[0]),1!=L.Browser.mobile){var p="<strong>File Name:</strong> "+a.name+"<br /><strong>Created By:</strong> "+a.createdBy+"<br /><strong>Last Modified:</strong> "+t("date")(a.lastModified,"dd MMMM, yyyy h:mm a");i.bindTooltip(p)}i.on("popupopen",function(){P.currentMarker=this;var e=i.getTooltip();e&&e.setOpacity(0)}),i.on("popupclose",function(){P.currentMarker=null;var e=i.getTooltip();e&&e.setOpacity(.9)}),P.markers.addLayer(i)}),P.map.addLayer(P.markers),i.stop({referenceId:"home-map"})}function k(){P.tableParams=new o({count:7,page:1,sorting:{lastModified:"desc"}},{counts:[],dataset:P.fileList}),i.stop({referenceId:"file-list"})}function C(t,n){var a=t.length;return{id:a+1,label:"slide #"+(a+1),img:"http://lorempixel.com/450/300/"+n+"/"+(a+1)%10,color:e.colors[10*a%e.colors.length],odd:a%2==0}}function S(e,t){e.push(C(e,t))}function T(e,t,n){for(var a=0;a<n;a++)S(e,t)}function A(t){var n=t.length,a=(e.galleryNumber-1)*e.setOfImagesToShow+n;return j[a]}function M(e,t){for(var n=0;n<t;n++)I(e)}function I(e){e.push(A(e))}var P=this;P.getFileList=v,P.viewFile=function(e){var t=a.open("about:blank","_blank");t.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),l.signDownload(e.path,e.name).then(function(e){if(setTimeout(function(){t.document.getElementById("loader").remove()},1e3),"doc"===e.type){var n="https://docs.google.com/viewer?url="+encodeURIComponent(e.url)+"&embedded=true";t.location=n}else t.location=e.url},function(){t.close()})},P.popupFileDetails=function(e){r.open({templateUrl:"/components/files/fileDetails/fileDetails.view.html",controller:"fileDetailsCtrl as vm",size:"lg",resolve:{file:function(){return e}}}).result.then(function(e){"delete"===e.action&&P.markers.removeLayer(P.currentMarker)},function(){})},P.map=null,P.posMarker=null,P.lat=-34.4054039,P.lng=150.87842999999998,P.currentUser=u.currentUser(),P.fileList=[],P.markers=[],P.currentMarker=null,P.pageHeader={title:"Dashboard",strapline:"summary of recent activity"};var F=L.Icon.extend({options:{shadowUrl:"assets/img/map/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),D=new F({iconUrl:"assets/img/map/markers/marker-icon-2x.png"}),B=new F({iconUrl:"assets/img/map/markers/File-Marker.png"}),z=new F({iconUrl:"assets/img/map/markers/Txt-Marker.png"}),U=new F({iconUrl:"assets/img/map/markers/Word-Marker.png"}),$=new F({iconUrl:"assets/img/map/markers/PDF-Doc-Marker.png"}),O=new F({iconUrl:"assets/img/map/markers/Image-Marker.png"}),N=new F({iconUrl:"assets/img/map/markers/Video-Marker.png"}),E=new F({iconUrl:"assets/img/map/markers/Audio-Marker.png"}),R=new F({iconUrl:"assets/img/map/markers/position-marker.png",iconSize:[50,62],iconAnchor:[25,62],shadowUrl:P.currentUser.avatar,shadowSize:[50,50],shadowAnchor:[25,62],className:"position-icon"});i.start({referenceId:"home-map"}),i.start({referenceId:"file-list"}),f(),e.colors=["#fc0003","#f70008","#f2000d","#ed0012","#e80017","#e3001c","#de0021","#d90026","#d4002b","#cf0030","#c90036","#c4003b","#bf0040","#ba0045","#b5004a","#b0004f","#ab0054","#a60059","#a1005e","#9c0063","#960069","#91006e","#8c0073","#870078","#82007d","#7d0082","#780087","#73008c","#6e0091","#690096","#63009c","#5e00a1","#5900a6","#5400ab","#4f00b0","#4a00b5","#4500ba","#4000bf","#3b00c4","#3600c9","#3000cf","#2b00d4","#2600d9","#2100de","#1c00e3","#1700e8","#1200ed","#0d00f2","#0800f7","#0300fc"],e.carouselIndex=3,e.carouselIndex2=0,e.carouselIndex2=1,e.carouselIndex3=5,e.carouselIndex4=5,P.testImages=[{title:"Visualisation #1",url:"assets/img/carousels/recent/bar-chart-preview.png"},{title:"Visualisation #2",url:"assets/img/carousels/recent/chord-diagram-preview.png"},{title:"Visualisation #3",url:"assets/img/carousels/recent/concept-map-preview.png"},{title:"Visualisation #4",url:"assets/img/carousels/recent/word-cloud-preview.png"},{title:"Visualisation #5",url:"assets/img/carousels/recent/word-tree-preview.png"}];var j=[];T(j,"sports",10),T(j,"people",10),T(j,"city",10),T(j,"abstract",10),T(j,"nature",10),T(j,"food",10),T(j,"transport",10),T(j,"animals",10),T(j,"business",10),T(j,"nightlife",10),T(j,"cats",10),T(j,"fashion",10),T(j,"technics",10),e.totalimg=j.length,e.galleryNumber=1,console.log(e.galleryNumber),e.slides7=[],e.carouselIndex7=0,e.setOfImagesToShow=3,M(e.slides7,e.setOfImagesToShow),e.loadNextImages=function(){j[j.length-1].id!==e.slides7[e.slides7.length-1].id?(e.slides7=[],e.carouselIndex7=0,++e.galleryNumber,M(e.slides7,e.setOfImagesToShow)):(e.galleryNumber=1,e.slides7=[],e.carouselIndex7=0,M(e.slides7,e.setOfImagesToShow))},e.loadPreviousImages=function(){j[0].id!==e.slides7[0].id?(e.slides7=[],e.carouselIndex7=0,--e.galleryNumber,M(e.slides7,e.setOfImagesToShow)):(e.galleryNumber=j.length/e.setOfImagesToShow,e.slides7=[],e.carouselIndex7=0,M(e.slides7,e.setOfImagesToShow))}}e.$inject=["$scope","$filter","$compile","$window","$uibModal","NgTableParams","bsLoadingOverlayService","filesService","s3Service","mapService","authService","analysisService","logger"],angular.module("home").controller("homeCtrl",e)}(),function(){function e(e){var t=this,n=10;t.radiusValue=100,t.opacityValue=.6,t.bothOver=!0,t.fatherOver=!0,t.MotherOver=!0,t.bothAus=!0,function(e,a){var r=new google.maps.LatLng(e,a),o=document.getElementById("map"),i={center:r,zoom:n,panControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT}},s=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:9029},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:358},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:3235},{location:new google.maps.LatLng(-33.76288,150.99212),weight:7427},{location:new google.maps.LatLng(-33.771,150.9063),weight:21538},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:4163},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:8865},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:1618},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:5627},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:3383},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:27386},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:11435},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:1552},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:979},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}],l=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:187},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:18},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:64},{location:new google.maps.LatLng(-33.76288,150.99212),weight:141},{location:new google.maps.LatLng(-33.771,150.9063),weight:224},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:130},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:202},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:96},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:132},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:165},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:179},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:123},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:107},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:128},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}],c=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:129},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:15},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:53},{location:new google.maps.LatLng(-33.76288,150.99212),weight:127},{location:new google.maps.LatLng(-33.771,150.9063),weight:151},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:106},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:173},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:60},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:83},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:98},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:145},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:98},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:59},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:95},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}],u=[{location:new google.maps.LatLng(-33.8584827,151.12866859999997),weight:68},{location:new google.maps.LatLng(-36.0737293,146.91354179999996),weight:13},{location:new google.maps.LatLng(-33.81527799999999,151.10111099999995),weight:45},{location:new google.maps.LatLng(-33.76288,150.99212),weight:66},{location:new google.maps.LatLng(-33.771,150.9063),weight:99},{location:new google.maps.LatLng(-33.8688197,151.20929550000005),weight:62},{location:new google.maps.LatLng(-33.83965,151.20541000000003),weight:116},{location:new google.maps.LatLng(-33.68919759999999,151.26853819999997),weight:65},{location:new google.maps.LatLng(-33.91735159999999,150.9283736),weight:69},{location:new google.maps.LatLng(-33.49999729999999,150.2499997),weight:96},{location:new google.maps.LatLng(-33.81499999999999,151.00111100000004),weight:84},{location:new google.maps.LatLng(-33.90006659999999,150.84785220000003),weight:43},{location:new google.maps.LatLng(-34.03314,151.05830000000003),weight:47},{location:new google.maps.LatLng(-33.3529519,151.44354739999994),weight:106},{location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110}],d=new google.maps.Map(o,i),p=new google.maps.visualization.HeatmapLayer,f=null,m=document.getElementById("radius-slider"),g=document.getElementById("opacity-slider");noUiSlider.create(m,{start:t.radiusValue,connect:[!0,!1],step:1,range:{min:0,max:200}}),noUiSlider.create(g,{start:t.opacityValue,connect:[!0,!1],step:.01,range:{min:0,max:1}}),m.noUiSlider.on("change",function(e,n,a){t.radiusValue=a[n],p.set("radius",t.radiusValue)}),g.noUiSlider.on("update",function(e,n,a){t.opacityValue=a[n],p.set("opacity",t.opacityValue)}),t.updateMap=function(){p&&p.setMap(null);var e=[];t.bothOver&&Array.prototype.push.apply(e,s),t.fatherOver&&Array.prototype.push.apply(e,l),t.MotherOver&&Array.prototype.push.apply(e,c),t.bothAus&&Array.prototype.push.apply(e,u),p.setData(e),p.setOptions({radius:t.radiusValue,opacity:t.opacityValue,gradient:f}),p.setMap(d)},t.removeGrtSyd=function(){t.rmGrtSyd?(s.pop(),l.pop(),c.pop(),u.pop()):(s.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:121088}),l.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:2219}),c.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1681}),u.push({location:new google.maps.LatLng(-33.88175470000001,150.8609358),weight:1110})),t.updateMap()},t.changeGradient=function(){f=t.changeGrad?["rgba(0, 255, 255, 0)","rgba(0, 255, 255, 1)","rgba(0, 191, 255, 1)","rgba(0, 127, 255, 1)","rgba(0, 63, 255, 1)","rgba(0, 0, 255, 1)","rgba(0, 0, 223, 1)","rgba(0, 0, 191, 1)","rgba(0, 0, 159, 1)","rgba(0, 0, 127, 1)","rgba(63, 0, 91, 1)","rgba(127, 0, 63, 1)","rgba(191, 0, 31, 1)","rgba(255, 0, 0, 1)"]:null,t.updateMap()},t.updateMap()}(-33.848192,151.061857)}e.$inject=["$scope"],angular.module("map").controller("heatmapCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o,i,s,l,c,u){function d(){var e={center:[-34.4054039,150.87842999999998],zoom:4};A.map=L.map("map",e);var t="pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:t,maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:t,maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:t,maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:t,maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:t,maxZoom:22}),s=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:t,maxZoom:22}).addTo(A.map),l=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:t,maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:t,maxZoom:22})),c=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:t,maxZoom:22}),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:t,maxZoom:22}),d=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:t,maxZoom:22}),f=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:t,maxZoom:22}),m=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:t,maxZoom:22}),h=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),v=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),b=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),w=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),x=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});x.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":n,"Mapbox Dark":a,"Mapbox Satellite":r,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":i,"Mapbox Streets Basic":s,"Mapbox Outdoors":l,"Mapbox Run Bike Hike":c,"Mapbox Pencil":u,"Mapbox Pirates":d,"Mapbox Emerald":f,"Mapbox High Contrast":m,"Google Roadmap":h,"Google Aerial":v,"Google Terrain":b,"Google Hybrid":w,"Google Traffic":x},{},{collapsed:!0}).addTo(A.map),A.posMarker=L.marker([A.lat,A.lng],{icon:O,zIndexOffset:-500}).bindTooltip("<strong>Your Position</strong>"),A.sidebar=L.control.sidebar("sidebar").addTo(A.map),p(),g(),y()}function p(){A.map.on("locationfound",f),A.map.on("locationerror",m),A.map.locate({setView:!0,maxZoom:15})}function f(e){var n=e.accuracy/2,a=e.latlng;A.posMarker.setLatLng(a),A.posMarker.bindPopup("<p style='margin: 5px !important;padding-top:8px;'>You are within "+t("formatDistance")(n)+" of this point</p>",{closeButton:!1}),A.posMarker.addTo(A.map);var r=L.circle(a,{radius:n,color:"#cb2529"});A.posMarker.on("popupopen",function(){r.addTo(A.map),A.map.fitBounds(r.getBounds())}),A.posMarker.on("popupclose",function(){A.map.removeLayer(r)})}function m(e){u.error(e.message,e,"Error")}function g(){i.getFileList().then(function(e){A.fileList=e,h()},function(e){o.stop({referenceId:"map"})})}function h(){A.markers=L.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:40}),A.fileList.forEach(function(a,r,o){if(!j||a.lastModified>=Z.min&&a.lastModified<=Z.max){var i,s=a.coords.coordinates[1],l=a.coords.coordinates[0];switch(a.type){case"file":i=L.marker([s,l],{icon:P});break;case"text":i=L.marker([s,l],{icon:F});break;case"doc":i=L.marker([s,l],{icon:D});break;case"pdf":i=L.marker([s,l],{icon:B});break;case"image":i=L.marker([s,l],{icon:z});break;case"video":i=L.marker([s,l],{icon:U});break;case"audio":i=L.marker([s,l],{icon:$});break;default:i=L.marker([s,l],{icon:I})}var c='<div class="info-window"><div style="background-color:#4676fa;border-radius: 12px 12px 0 0 !important;text-align:center;"><h3 style="color:#FFF;margin-left:8px;margin-right:5px;padding-bottom:5px;padding-top:5px;padding-right:18px;">'+a.name+'</h3></div><div style="margin-left: 15px;margin-right:15px;margin-top:5px;margin-bottom:15px;"><p><strong>Created By:</strong> '+a.createdBy+"<br /><strong>Size:</strong> "+t("formatFileSize")(a.size,2)+"<br /><strong>Last Modified:</strong> "+t("date")(a.lastModified,"dd MMMM, yyyy h:mm a");0!=a.tags.length?(c+="<br /><strong>Tags:</strong> ",c+=a.tags.join(", ")+"</p>"):c+="</p>",c+='<div style="padding-bottom:10px;"></div><div style="text-align:center;"><a ng-click="vm.viewFile(file)" class="btn btn-success btn-xs" role="button">View</a> <a ng-click="vm.popupFileDetails(file)" class="btn btn-primary blueButton btn-xs" role="button">Details</a> <a ng-click="vm.selectDependent(precedent)" class="btn btn-info btn-xs" role="button">Add Dependent</a></div></div></div>';var u=n(angular.element(c)),d=e.$new();if(d.file={name:a.name,path:a.path,key:a.key,textFileKey:a.textFileKey},d.precedent={_id:a._id,lat:s,lng:l},i.bindPopup(u(d)[0]),1!=L.Browser.mobile){var p="<strong>File Name:</strong> "+a.name+"<br /><strong>Created By:</strong> "+a.createdBy+"<br /><strong>Last Modified:</strong> "+t("date")(a.lastModified,"dd MMMM, yyyy h:mm a");i.bindTooltip(p)}i.on("popupopen",function(){A.currentMarker=this;var e=i.getTooltip();e&&e.setOpacity(0)}),i.on("popupclose",function(){A.currentMarker=null;var e=i.getTooltip();e&&e.setOpacity(.9)}),A.markers.addLayer(i),o[r].marker=i,j||(0==r?(_=a.lastModified,q=a.lastModified):(_>a.lastModified&&(_=a.lastModified),q<a.lastModified&&(q=a.lastModified)))}}),A.map.addLayer(A.markers),o.stop({referenceId:"map"}),j||T()}function v(){A.map.removeLayer(A.markers),A.markers=null}function y(){l.getLinks().then(function(e){A.linkList=e})}function b(){A.linksHidden=!1,A.linkList.forEach(function(a){if(!j||a.dateCreated>=Z.min&&a.dateCreated<=Z.max){var r=L.polyline([[a.dependent.coords.coordinates[1],a.dependent.coords.coordinates[0]],[a.precedent.coords.coordinates[1],a.precedent.coords.coordinates[0]]],{color:"#4676fa",weight:8}).addTo(A.map),o=L.polylineDecorator(r,{patterns:[{offset:"100%",repeat:0,symbol:L.Symbol.arrowHead({pixelSize:18,polygon:!1,pathOptions:{stroke:!0,weight:5,color:"#4676fa"}})}]}).addTo(A.map),i='<div class="info-window"><div style="background-color:#4676fa;border-radius: 12px 12px 0 0 !important;text-align:center;"><h3 style="color:#FFF;margin-left:5px;margin-right:5px;padding-bottom:5px;padding-top:5px;">'+a.name+'</h3></div><div style="margin-left: 15px;margin-right:15px;margin-top:5px;margin-bottom:15px;"><p><strong>Description:</strong> '+a.description+"<br /><strong>Created By:</strong> "+a._creator.firstName+"<br /><strong>Date Created:</strong> "+t("date")(a.dateCreated,"dd MMMM, yyyy h:mm a")+'</p><div style="padding-bottom:10px;"></div><a ng-click="vm.confirmLinkDelete(link)" class="btn btn-danger btn-xs" role="button">Delete</a></div></div>',s=n(angular.element(i)),l=e.$new();if(l.link=a,r.bindPopup(s(l)[0]),1!=L.Browser.mobile){var c="<strong>Name:</strong> "+a.name+"<br />";a.description.length<75&&(c+="<strong>Description:</strong> "+a.description+"<br />"),c+="<strong>Date Created:</strong> "+t("date")(a.dateCreated,"dd MMMM, yyyy h:mm a"),r.bindTooltip(c,{sticky:!0})}r.on("popupopen",function(){A.currentLink={line:this,head:o};var e=r.getTooltip();e&&e.setOpacity(0)}),r.on("popupclose",function(){A.currentLink=null;var e=r.getTooltip();e&&e.setOpacity(.9)}),A.arrows.push(r),A.arrowHeads.push(o)}})}function w(){A.linksHidden=!0,A.arrows.forEach(function(e){A.map.removeLayer(e)}),A.arrowHeads.forEach(function(e){A.map.removeLayer(e)})}function x(e){r.open({templateUrl:"/components/map/linkInfo/linkInfo.view.html",controller:"linkInfoCtrl as vm",size:"lg",resolve:{markers:function(){return e}}}).result.then(function(e){A.linkList.push(e),A.linksHidden||(w(),b()),v(),h()},function(){v(),h()})}function k(e){l.deleteLink(e._id).then(function(){C(e),u.success("'"+e.name+"' was deleted successfully","","Success")})}function C(e){var t=A.currentLink;A.map.removeLayer(t.line),A.map.removeLayer(t.head),S(e)}function S(e){var t=A.linkList.findIndex(function(t){return t._id==e._id});t>-1&&A.linkList.splice(t,1)}function T(){function e(e){return new Date(e).getTime()}function t(e){if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function n(e){return e.getDate()+t(e.getDate())+" "+N[e.getMonth()]+" "+e.getFullYear()}noUiSlider.create(R,{range:{min:e(_),max:e(q)},connect:!0,step:864e5,start:[e(_),e(q)],format:{to:function(e){return Math.floor(e)},from:function(e){return Math.floor(e)}}}),R.noUiSlider.on("update",function(e,t){E[t].innerHTML=n(new Date(+e[t]))}),R.noUiSlider.on("update",function(e,t){j=!0,Z.min=new Date(e[0]).toISOString(),Z.max=new Date(e[1]).toISOString(),A.markers&&v(),h(),A.linksHidden||(w(),b())})}var A=this;A.viewFile=function(e){var t=a.open("about:blank","_blank");t.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),s.signDownload(e.path,e.name).then(function(e){if(setTimeout(function(){t.document.getElementById("loader").remove()},1e3),"doc"===e.type){var n="https://docs.google.com/viewer?url="+encodeURIComponent(e.url)+"&embedded=true";t.location=n}else t.location=e.url},function(){t.close()})},A.popupFileDetails=function(e){r.open({templateUrl:"/components/files/fileDetails/fileDetails.view.html",controller:"fileDetailsCtrl as vm",size:"lg",resolve:{file:function(){return e}}}).result.then(function(e){"delete"===e.action&&A.markers.removeLayer(A.currentMarker)},function(){})},A.fileSearchHover=function(e,t){if("enter"===e){var n=t.coords.coordinates[1],a=t.coords.coordinates[0];A.curFileSearchHov.setLatLng([n,a]),A.curFileSearchHov.addTo(A.map)}else"exit"===e&&A.curFileSearchHov.remove()},A.fileSearchClick=function(e){A.markers.zoomToShowLayer(e.marker,function(){e.marker.isPopupOpen()?e.marker.closePopup():(e.marker.openPopup(),L.Browser.mobile&&A.sidebar.close())})},A.confirmLinkDelete=function(e){swal({title:"Are you sure?",text:"Confirm to delete the link '"+e.name+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){k(e)})},A.selectDependent=function(e){A.addingLink=!0,v(),A.markers=L.markerClusterGroup({showCoverageOnHover:!1}),A.fileList.forEach(function(n){if(n.coords.coordinates[1]!=e.lat&&n.coords.coordinates[0]!=e.lng){var a,r=n.coords.coordinates[1],o=n.coords.coordinates[0];switch(n.type){case"file":a=L.marker([r,o],{icon:P});break;case"text":a=L.marker([r,o],{icon:F});break;case"doc":a=L.marker([r,o],{icon:D});break;case"pdf":a=L.marker([r,o],{icon:B});break;case"image":a=L.marker([r,o],{icon:z});break;case"video":a=L.marker([r,o],{icon:U});break;case"audio":a=L.marker([r,o],{icon:$});break;default:a=L.marker([r,o],{icon:I})}var i="<strong>File Name:</strong> "+n.name+"<br /><strong>Created By:</strong> "+n.createdBy+"<br /><strong>Last Modified:</strong> "+t("date")(n.lastModified,"dd MMMM, yyyy h:mm a");a.bindTooltip(i),a.on("click",function(){A.addingLink=!1,x({precedent:e._id,dependent:n._id})}),A.markers.addLayer(a)}}),A.map.addLayer(A.markers)},A.toggleLinks=function(){A.linksHidden?b():w()},A.cancelAddingLink=function(){A.addingLink=!1,v(),h()},A.map=null,A.posMarker=null,A.lat=-34.4054039,A.lng=150.87842999999998,A.sidebar=null,A.currentUser=c.currentUser(),A.fileList=[],A.markers={},A.currentMarker=null,A.curFileSearchHov=L.circleMarker([0,0],{radius:35}),A.linkList=[],A.linksHidden=!0,A.currentLink=null,A.arrows=[],A.arrowHeads=[],A.addingLink=!1;var M=L.Icon.extend({options:{shadowUrl:"assets/img/map/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),I=new M({iconUrl:"assets/img/map/markers/marker-icon-2x.png"}),P=new M({iconUrl:"assets/img/map/markers/File-Marker.png"}),F=new M({iconUrl:"assets/img/map/markers/Txt-Marker.png"}),D=new M({iconUrl:"assets/img/map/markers/Word-Marker.png"}),B=new M({iconUrl:"assets/img/map/markers/PDF-Doc-Marker.png"}),z=new M({iconUrl:"assets/img/map/markers/Image-Marker.png"}),U=new M({iconUrl:"assets/img/map/markers/Video-Marker.png"}),$=new M({iconUrl:"assets/img/map/markers/Audio-Marker.png"}),O=new M({iconUrl:"assets/img/map/markers/position-marker.png",iconSize:[50,62],iconAnchor:[25,62],shadowUrl:A.currentUser.avatar,shadowSize:[50,50],shadowAnchor:[25,62],className:"position-icon"}),N=["January","February","March","April","May","June","July","August","September","October","November","December"],E=[document.getElementById("event-start"),document.getElementById("event-end")],R=document.getElementById("slider-date"),j=!1,_=null,q=null,Z={min:0,max:0};o.start({referenceId:"map"}),d()}e.$inject=["$scope","$filter","$compile","$window","$uibModal","bsLoadingOverlayService","filesService","s3Service","mapService","authService","logger"],angular.module("map").controller("mapCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r){function o(){n.listSurveys().then(function(e){c.surveyList=e,i()},function(e){a.stop({referenceId:"survey-list"})})}function i(){c.tableParams=new t({sorting:{lastModified:"desc"}},{dataset:c.surveyList}),a.stop({referenceId:"survey-list"})}function s(e,t){n.deleteSurvey(e).then(function(){l(e),r.success("'"+t+"' was deleted successfully","","Success")})}function l(e){var t=c.surveyList.findIndex(function(t){return t._id===e});t>-1&&c.surveyList.splice(t,1),i()}var c=this;c.pageId="survey-page-css",c.confirmDelete=function(e,t){swal({title:"Are you sure?",text:"Confirm to delete the survey '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){s(e,t)})},c.goToResponsesUrl=function(t){e.path("survey/responses/"+t)},c.pageHeader={title:"Surveys",strapline:"create, edit and view"},c.surveyList={},a.start({referenceId:"survey-list"}),o()}e.$inject=["$location","NgTableParams","surveyService","bsLoadingOverlayService","logger"],angular.module("survey").controller("surveyCtrl",e)}(),function(){angular.module("directives").directive("droppable",function(){return{scope:{drop:"&"},link:function(e,t){var n=t[0];n.addEventListener("dragover",function(e){return e.dataTransfer.dropEffect="move",e.preventDefault&&e.preventDefault(),this.classList.add("over"),!1},!1),n.addEventListener("dragenter",function(e){return this.classList.add("over"),!1},!1),n.addEventListener("dragleave",function(e){return this.classList.remove("over"),!1},!1),n.addEventListener("drop",function(t){return t.stopPropagation&&t.stopPropagation(),this.classList.remove("over"),e.$apply("drop()"),!1},!1)}}})}(),function(){angular.module("directives").directive("pwCheck",function(){return{require:"ngModel",link:function(e,t,n,a){var r="#"+n.pwCheck;$(t).add(r).on("keyup",function(){e.$apply(function(){var e=t.val()===$(r).val();a.$setValidity("pwcheck",e)})})}}})}(),function(){function e(e,t,n,a,r,o){function i(){r.start({referenceId:"visuals-info"}),n.readWatsonAnalysis(l.analysisId).then(function(e){r.stop({referenceId:"visuals-info"}),l.analysisData=e,s()})}function s(){var e=[];l.analysisData.files.forEach(function(t){e.push(t)}),l.analysisData.deletedFiles.forEach(function(t){t.type="deleted",e.push(t)}),l.tableParams=new o({count:e.length,sorting:{lastModified:"desc"}},{dataset:e,counts:[]}),r.stop({referenceId:"visuals-info"})}var l=this;document.body.scrollTop=0,document.documentElement.scrollTop=0,l.viewFile=function(e,n){if("deleted"!=e.type){var r=t.open("about:blank","_blank");r.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),a.signDownload(e.path,e.name,n).then(function(e){if(setTimeout(function(){var e=r.document.getElementById("loader");e&&e.remove()},1e3),"true"===n)r.location=e.url;else{var t="https://docs.google.com/viewer?url="+encodeURIComponent(e.url)+"&embedded=true";r.location=t}},function(){r.close()})}},l.toggleOptions=function(){c.toggle()},l.togglePage=function(e){switch(l.details=!1,l.categories=!1,l.concepts=!1,l.entities=!1,l.keywords=!1,l.relations=!1,l.semanticRoles=!1,c.close(),e){case"details":l.details=!0;break;case"categories":l.categories=!0;break;case"concepts":l.concepts=!0;break;case"entities":l.entities=!0;break;case"keywords":l.keywords=!0;break;case"relations":l.relations=!0;break;case"semanticRoles":l.semanticRoles=!0;break;default:l.details=!0}},l.pageId="visualisations-index",l.analysisId=e.id,l.analysisData={},l.tableParams,l.details=!0,l.categories=!1,l.concepts=!1,l.entities=!1,l.keywords=!1,l.relations=!1,l.semanticRoles=!1;var c=new Slideout({panel:document.querySelector("#viPanel"),menu:document.querySelector("#viMenu"),padding:256,tolerance:70});i(),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)}e.$inject=["$routeParams","$window","analysisService","s3Service","bsLoadingOverlayService","NgTableParams"],angular.module("visualisations").controller("visualisationsCtrl",e)}(),function(){"use strict";function e(e,t){return{getCurrentPosition:function(){var n=e.defer();return t.navigator.geolocation?t.navigator.geolocation.getCurrentPosition(function(e){n.resolve(e)},function(e){n.reject(e)}):n.reject("Geolocation not supported."),n.promise}}}e.$inject=["$q","$window"],angular.module("factories").factory("geolocationSvc",e)}(),function(){angular.module("filters").filter("addHtmlLineBreaks",function(){return function(e){return e.replace(/\n/g,"<br/>")}})}(),function(){angular.module("filters").filter("capitalise",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}})}(),function(){function e(e){return function(t,n){if(angular.isDefined(n)){var a,r=[],o=n.toLowerCase();for(a=0;a<t.length;a++){var i=t[a].name.toLowerCase(),s=t[a].createdBy.toLowerCase(),l=e("date")(t[a].lastModified,"dd MMMM, yyyy").toLowerCase();(i.indexOf(o)>=0||s.indexOf(o)>=0||l.indexOf(o)>=0)&&r.push(t[a])}return r}return t}}e.$inject=["$filter"],angular.module("filters").filter("fileSearch",e)}(),function(){angular.module("filters").filter("formatDistance",function(){return function(t){var n,a=t/1e3;return t&&e(t)?(a>1?(a=parseFloat(a).toFixed(1),n=" km"):(a=parseInt(1e3*a,10).toFixed(1),n=" m"),a+n):"?"}});var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)}}(),function(){angular.module("filters").filter("formatFileSize",function(){return function(e,t){if(0===e||isNaN(parseFloat(e))||!isFinite(e))return"";void 0===t&&(t=1);var n=["bytes","kB","MB","GB","TB","PB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+" "+n[a]}})}(),function(){"use strict";function e(e,t,n){return{watsonAnalysis:function(a){return e.post("/api/analysis/watson",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed Watson analysis.")(e)})},saveWatsonAnalysis:function(a){return e.post("/api/analysis/watson/save",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed saving the analysis.")(e)})},readWatsonAnalysis:function(a){return e.get("/api/analysis/watson/read/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading the analysis.")(e)})},readWatsonCategories:function(a){return e.get("/api/analysis/watson/read/"+a+"/categories",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading the categories results.")(e)})},listWatsonAnalysis:function(){return e.get("/api/analysis/watson/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed listing the analyses.")(e)})},deleteWatsonAnalysis:function(a){return e.delete("/api/analysis/watson/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting the analysis.")(e)})},watsonTextAnalysis:function(a){return e.post("/api/analysis/watsonText",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed Watson analysis.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("analysisService",e)}(),function(){function e(e,t,n,a,r){function o(e){n.localStorage["nativeQDA-token"]=e}function i(){return n.localStorage["nativeQDA-token"]}function s(e){n.localStorage.removeItem("nativeQDA-token")}function l(){var t=i();return!!t&&(JSON.parse(n.atob(t.split(".")[1])).exp<Date.now()/1e3&&swal({title:"You have been logged out",text:"Your security token has expired, please login again to continue",type:"warning",confirmButtonColor:"#d9534f",confirmButtonText:"Okay"},function(){return s(),r.path("/login"),e.$apply(),!1}),!0)}function c(){return t.get("/api/user/last-modified",{headers:{Authorization:"Bearer "+i()}}).then(function(e){return e.data}).catch(function(e){return a.catcher("Failed getting the user's last modified date.")(e)})}return{register:function(e){return t.post("/api/register",e).then(function(e){o(e.data.token)}).catch(function(e){return a.catcher("Registration Failed")(e)})},login:function(e){return t.post("/api/login",e).then(function(e){o(e.data.token)}).catch(function(e){return a.catcher("Login Failed")(e)})},saveToken:o,getToken:i,logout:s,forgotPassword:function(e){return t.post("/api/password/forgot/",e).then(function(e){return e.data}).catch(function(e){return a.catcher("Forgot Password Failed")(e)})},resetPassword:function(e){return t.post("/api/password/reset/",e).then(function(e){return e.data}).catch(function(e){return a.catcher("Reset Password Failed")(e)})},isLoggedIn:l,currentUser:function(){if(l()){var e=i(),t=JSON.parse(n.atob(e.split(".")[1]));return{_id:t._id,email:t.email,firstName:t.firstName,settings:t.settings,avatar:t.avatar,iat:t.iat}}},checkJWT:function(){var t=i();if(t){var a=JSON.parse(n.atob(t.split(".")[1]));c().then(function(t){var n=new Date(t.lastModified);parseInt(n.getTime()/1e3)>a.iat&&swal({title:"You have been logged out",text:"Your security token is not up to date, please login again to continue",type:"warning",confirmButtonColor:"#d9534f",confirmButtonText:"Okay"},function(){return s(),r.path("/login"),e.$apply(),!1})})}},lastModified:c}}e.$inject=["$rootScope","$http","$window","exception","$location"],angular.module("services").service("authService",e)}(),function(){function e(e,t,n){return{datasetCreate:function(a){return e.post("/api/analysis/data/create",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed creating the dataset.")(e)})},listDatasets:function(){return e.get("/api/analysis/data/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed listing the datasets.")(e)})},datasetReadOne:function(a){return e.get("/api/analysis/data/read/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading the dataset.")(e)})},deleteDatasetDB:function(a){var r=encodeURIComponent(a);return e.delete("/api/analysis/data/delete?key="+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting the dataset from the DB.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("datasetService",e)}(),function(){"use strict";function e(e,t){return{catcher:function(n){return function(a){var r;return n&&(n+="\n"),a.data&&a.data.description?(r=n+a.data.description,a.data.description=r):a.data&&a.data.message?(r=n+a.data.message,a.data.message=r):a.data&&a.data.errmsg?11e3===a.data.code?r=n+"Email already exists in the database":(r=n+a.data.errmsg,a.data.errmsg=r):a.data&&a.data.error&&(r=n+a.data.error,a.data.error=r),t.error(r,a,"Error"),e.reject(a)}}}}e.$inject=["$q","logger"],angular.module("services").service("exception",e)}(),function(){"use strict";function e(e,t,n){return{addFile:function(a){function r(e){return e.data}function o(e){return n.catcher("Failed adding the file to the database.")(e)}return"/"==a.path?e.put("/api/files/"+a.name,a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(r).catch(o):e.put("/api/files/"+a.path+"/"+a.name,a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(r).catch(o)},getFileList:function(a){return e.get("/api/map/?getTextFile="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed listing the files from the database.")(e)})},getFile:function(a,r,o){if(o||(o="false"),"/"===a&&""===r)i="/api/files/?getTextFile="+o;else if(""===r)i="/api/files/"+a+"?getTextFile="+o;else var i="/api/files/"+a+"/"+r+"?getTextFile="+o;return e.get(i,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed getting the file/folder from the database.")(e)})},deleteFile:function(a,r){return e.delete("/api/files/"+a+"/"+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting the file from the database.")(e)})},fileReadOne:function(a){return e.get("/api/files/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading the file form the database.")(e)})},updateACL:function(a){return e.post("/api/files/acl",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed changing the file's permissions in the database.")(e)})},syncDBwithS3:function(a){return e.post("/api/s3/syncDB",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed syncDBwithS3.")(e)})},downloadFile:function(t){return e.get(t).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed downloading file.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("filesService",e)}(),function(){"use strict";function e(e){return{showToasts:!0,error:function(t,n,a){toastr.error(t,a),e.error("Error: "+t,n)},info:function(t,n,a){toastr.info(t,a),e.info("Info: "+t,n)},success:function(t,n,a){toastr.success(t,a),e.info("Success: "+t,n)},warning:function(t,n,a){toastr.warning(t,a),e.warn("Warning: "+t,n)},log:e.log}}e.$inject=["$log"],angular.module("services").service("logger",e)}(),function(){"use strict";function e(e,t,n){return{putLink:function(a){return e.put("/api/map/link",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed saving the marker link.")(e)})},getLinks:function(){return e.get("/api/map/link",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed getting the marker links.")(e)})},deleteLink:function(a){return e.delete("/api/map/link/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting the marker link.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("mapService",e)}(),function(){"use strict";function e(e,t,n){return{signUpload:function(a){return e.post("/api/s3/signUpload",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed signing the S3 upload URL.")(e)})},signDownload:function(a,r,o){if(o||(o="false"),"/"==a)i="/api/files/"+r+"/download?getTextFile="+o;else var i="/api/files/"+a+"/"+r+"/download?getTextFile="+o;return e.get(i,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed signing the S3 download URL.")(e)})},signDownloadKey:function(a){return e.get("/api/s3/signDownload/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed signing the S3 download URL.")(e)})},deleteFile:function(a){return e.delete("/api/s3/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting the file from S3.")(e)})},getFileList:function(){return e.get("/api/s3/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed listing the files from S3.")(e)})},updateACL:function(a){return e.post("/api/s3/acl",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed updating the file's S3 permissions.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("s3Service",e)}(),function(){"use strict";function e(e,t,n){return{saveSurvey:function(a){return e.post("/api/survey/save",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed saving survey.")(e)})},checkSurvey:function(a){var r=encodeURIComponent(a);return e.get("/api/survey/check?accessId="+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed checking survey.")(e)})},readSurvey:function(a){var r=encodeURIComponent(a);return e.get("/api/survey/read?accessId="+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading survey.")(e)})},readSurveyJSON:function(a){return e.get("/api/survey/read/json/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading survey.")(e)})},listSurveys:function(){return e.get("/api/survey/list",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed listing surveys.")(e)})},deleteSurvey:function(a){var r=encodeURIComponent(a);return e.delete("/api/survey/delete?id="+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting survey.")(e)})},saveSurveyResponse:function(a){return e.post("/api/survey/response/save",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed saving survey response.")(e)})},readOneSurveyResponse:function(a,r){return e.get("/api/survey/"+a+"/response/"+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading survey response.")(e)})},readSurveyResponses:function(a){var r=encodeURIComponent(a);return e.get("/api/survey/responses/read?accessId="+r,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed reading survey response.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("surveyService",e)}(),function(){"use strict";function e(e,t,n){return{createUser:function(a){return e.post("/api/user",a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Creating new user failed")(e)})},getUserInfo:function(a){return e.get("/api/user/info?email="+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed getting the user's info.")(e)})},getAllUsersInfo:function(){return e.get("/api/users/info",{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed getting all user's info.")(e)})},getAvatar:function(n){return e.get("/api/user/avatar/"+n,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data})},updateProfile:function(a){return e.put("/api/user/"+a.email,a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed updating the user's profile.")(e)})},deleteUser:function(a){return e.delete("/api/user/"+a,{headers:{Authorization:"Bearer "+t.getToken()}}).then(function(e){return e.data}).catch(function(e){return n.catcher("Failed deleting user's profile.")(e)})}}}e.$inject=["$http","authService","exception"],angular.module("services").service("usersService",e)}(),function(){"use strict";function e(e,t,n,a,r,o,i,s,l,c){function u(){h.fileIds=[],h.selectedFiles=[],h.fileIds=Object.keys(h.selectedFileIds).filter(function(e){return h.selectedFileIds[e]}),h.fileIds.forEach(function(e){var t=h.allFilesSoFar.findIndex(function(t){return t._id==e});h.selectedFiles.push(h.allFilesSoFar[t])})}function d(){l.start({referenceId:"file-list"}),r.getFile(h.currentPath,"","true").then(function(e){e.forEach(function(e){h.allFilesSoFar.pushIfNotExist(e,function(t){return t._id===e._id})}),h.fileList=e.map(function(e){return"folder"===e.type?e.typeOrder=1:e.typeOrder=2,e}),""!=h.currentPath&&h.fileList.push({name:"..",lastModified:"",createdBy:"",size:"",type:"parent-dir",typeOrder:0}),p()},function(e){l.stop({referenceId:"file-list"})})}function p(){h.tableParams=new n({sorting:{typeOrder:"asc",lastModified:"desc"}},{dataset:h.fileList}),l.stop({referenceId:"file-list"})}function f(){g(!0,null);var e=0,t="";h.selectedFiles.forEach(function(n){c.signDownloadKey(n.textFileKey).then(function(n){r.downloadFile(n).then(function(n){t+=n+"\n\n",++e===h.selectedFiles.length&&m(t)},function(e){g(!1,"error")})},function(e){g(!1,"error")})})}function m(e){var t={text:e,name:h.formData.analysisName,description:h.formData.description,createdBy:i.currentUser().firstName,files:h.fileIds};o.watsonTextAnalysis(t).then(function(e){s.success('Analysis "'+h.formData.analysisName+'" successfully completed',"","Success"),g(!1,"success"),setTimeout(function(){h.modal.close(e)},1e3)},function(e){g(!1,"error")})}function g(e,t){h.isSubmittingButton=e,h.resultButton=t,h.isProcessing=e}var h=this;h.pageId="new-analysis-css",h.onSubmit=function(){if(angular.isDefined(h.formData))if(h.formData.analysisName&&h.formData.description){if(!(h.selectedFiles.length<1))return f(),!0;s.error("Please select at least one file for analysis.","","Error")}else s.error("All fields required, please try again","","Error");else s.error("All fields required, please try again","","Error")},h.viewFile=function(e,n){var a=t.open("about:blank","_blank");a.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),c.signDownload(e.path,e.name,n).then(function(e){if(setTimeout(function(){var e=a.document.getElementById("loader");e&&e.remove()},1e3),"true"===n)a.location=e.url;else{var t="https://docs.google.com/viewer?url="+encodeURIComponent(e.url)+"&embedded=true";a.location=t}},function(){a.close()})},h.updateSelected=u,h.checkOrOpen=function(e){"folder"===e.type?("/"===e.path?h.currentPath=e.name:h.currentPath=e.path+"/"+e.name,h.pathsArray=h.currentPath.split("/"),d()):"parent-dir"===e.type?(h.currentPath=h.currentPath.substr(0,h.currentPath.lastIndexOf("/")),h.pathsArray=h.currentPath.split("/"),d()):(h.selectedFileIds[e._id]=!h.selectedFileIds[e._id],u())},h.fileList=[],h.currentPath="",h.pathsArray=[""],h.tableParams,h.formData={},h.analysisResults,h.isSubmittingButton=null,h.resultButton=null,h.analyseButtonOptions={buttonDefaultText:"Analyse",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},h.isProcessing=!1,h.allFilesSoFar=[],h.selectedFileIds=[],h.fileIds=[],h.selectedFiles=[],Array.prototype.inArray=function(e){for(var t=0;t<this.length;t++)if(e(this[t]))return!0;return!1},Array.prototype.pushIfNotExist=function(e,t){this.inArray(t)||this.push(e)},d(),h.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}e.$inject=["$uibModalInstance","$window","NgTableParams","datasetService","filesService","analysisService","authService","logger","bsLoadingOverlayService","s3Service"],angular.module("analysis").controller("newAnalysisCtrl",e)}(),function(){"use strict";function e(e,t){function n(){e.forgotPassword({email:a.email}).then(function(e){t.success("A link to reset your password has been sent to "+a.email,"","Success"),a.reset=!0})}var a=this;a.pageId="forgot-password-css",a.onSubmit=function(){if(!a.email)return t.error("All fields required, please try again","","Error"),!1;n()},a.email="",a.reset=!1,a.pageHeader={title:"Forgot Password"}}e.$inject=["authService","logger"],angular.module("auth").controller("forgotPassCtrl",e)}(),function(){"use strict";function e(e,t,n,a){function r(){t.login(o.credentials).then(function(t){e.search("page",null),e.path(o.returnPage)})}var o=this;o.pageId="login-page-css",o.onSubmit=function(){return o.credentials.email&&o.credentials.password?(r(),!0):(n.error("All fields required, please try again","Error","Error"),!1)},o.login=r,o.getAvatar=function(){o.credentials.email?a.getAvatar(o.credentials.email).then(function(e){o.avatarUrl=e?e.avatar:"assets/img/settings/default-avatar.png"}):o.avatarUrl="assets/img/settings/default-avatar.png"},o.credentials={email:"",password:""},o.pageHeader={title:"Sign in to nativeQDA"},o.returnPage=e.search().page||"/",o.avatarUrl="assets/img/settings/default-avatar.png"}e.$inject=["$location","authService","logger","usersService"],angular.module("auth").controller("loginCtrl",e)}(),function(){function e(e,t,n){function a(){t.register(r.credentials).then(function(){e.search("page",null),e.path(r.returnPage)})}var r=this;r.onSubmit=function(){if(!(r.credentials.password&&r.credentials.email&&r.credentials.firstName&&r.credentials.lastName))return n.error("Missing fields required, please try again","","Error"),!1;a()},r.register=a,r.credentials={password:"",email:"",firstName:"",lastName:"",company:""},r.pageHeader={title:"Create a new NativeQDA account"},r.returnPage=e.search().page||"/"}angular.module("auth").controller("registerCtrl",e),e.$inject=["$location","authService","logger"]}(),function(){"use strict";function e(e,t,n,a,r){function o(){e.resetPassword({token:s,password:i.credentials.password}).then(function(e){t.success("Your new password has been saved. Redirecting to the login page in 3 seconds.","","Success"),r(function(){a.path("/login")},3e3)})}var i=this,s=n.token;i.onSubmit=function(){if(!i.credentials.password||!i.credentials.confirmPassword)return t.error("All fields required, please try again","","Error"),!1;o()},i.pageHeader={title:"Reset Password"}}e.$inject=["authService","logger","$routeParams","$location","$timeout"],angular.module("auth").controller("resetPasswordCtrl",e)}(),function(){function e(e,t,n,a,r,o,i,s,l){function c(){r.listDatasets().then(function(e){m.dataset=e,u()},function(e){s.stop({referenceId:"dataset-list"})})}function u(){m.tableParams=new a({sorting:{dateCreated:"desc"}},{dataset:m.dataset}),s.stop({referenceId:"dataset-list"})}function d(e,t){r.deleteDatasetDB(e).then(function(n){p(e,t)})}function p(e,t){l.deleteFile(e).then(function(n){f(e),o.success('Dataset "'+t+'" was successfully deleted',"","Success")})}function f(e){var t=m.dataset.findIndex(function(t){return t.key==e});t>-1&&m.dataset.splice(t,1),u()}var m=this;m.getDatasetList=c,m.confirmDelete=function(e,t){swal({title:"Are you sure?",text:"Confirm to delete the dataset '"+t+"'",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){d(e,t)})},m.popupViewDataset=function(e){n.open({templateUrl:"/components/files/datasets/viewDataset/viewDataset.view.html",controller:"viewDatasetCtrl as vm",size:"lg",resolve:{datasetId:function(){return e}}}).result.then(function(){})},m.popupEditDataset=function(e,t){n.open({templateUrl:"/components/files/datasets/editDataset/editDataset.view.html",controller:"editDatasetCtrl as vm",size:"xl"}).result.then(function(){})},m.popupNewDataset=function(){n.open({templateUrl:"/components/files/datasets/newDataset/newDataset.view.html",controller:"newDatasetCtrl as vm",size:"xl"}).result.then(function(e){m.dataset.push(e),u()})},m.dataset=[],m.pageHeader={title:"Datasets",strapline:"where the Datasets live"},s.start({referenceId:"dataset-list"}),c()}e.$inject=["$window","$sce","$uibModal","NgTableParams","datasetService","logger","filesService","bsLoadingOverlayService","s3Service"],angular.module("datasets").controller("datasetsCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o,i){function s(e){r.updateACL({key:u.file.key,acl:e}).then(function(){u.resultButton="success",u.file.acl=e},function(e){u.resultButton="error"})}function l(){r.deleteFile(u.file.path,u.file.name).then(function(){c()})}function c(){o.deleteFile(u.file.key).then(function(){u.file.textFileKey&&u.file.textFileKey!=u.file.key&&o.deleteFile(u.file.textFileKey),u.modal.close({action:"delete"}),i.success("'"+u.file.name+"' was deleted successfully","","Success")})}var u=this;u.editFile=function(){console.log("hi")},u.updateAclS3=function(e){u.isSubmittingButton=!0,console.log(u.file.key),o.updateACL({key:u.file.key,acl:e}).then(function(){s(e)},function(e){u.resultButton="error"})},u.confirmDelete=function(){swal({title:"Are you sure?",html:!0,text:"<p>Confirm to delete the file '<strong>"+u.file.name+"</strong>'</p>",type:"warning",showCancelButton:!0,allowOutsideClick:!0,closeOnConfirm:!1,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){u.file.analyses.length>0?swal({title:"Are you positive?",html:!0,text:"<p>'<strong>"+u.file.name+"</strong>' is included in an analysis, are you still sure you want to delete this file?</p><br /><p>The analysis results will still be available.</p>",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes! delete it!"},function(){l()}):(l(),swal.close())})},u.file={},u.isSubmittingButton=null,u.resultButton=null,u.edit={buttonDefaultText:"Edit",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},u.makePublicOptions={buttonDefaultText:"Make Public",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},u.makePrivateOptions={buttonDefaultText:"Make Private",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},a.start({referenceId:"file-details"}),r.getFile(e.path,e.name).then(function(e){a.stop({referenceId:"file-details"}),u.file=e,u.file.tags&&(u.tags=u.file.tags.join(", "))}),u.modal={close:function(e){t.close(e)},cancel:function(){t.dismiss("cancel")}}}e.$inject=["file","$uibModalInstance","$window","bsLoadingOverlayService","filesService","s3Service","logger"],angular.module("files").controller("fileDetailsCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o,i,s,l,c,u,d,p,f,m,g){function h(){l.start({referenceId:"file-list"}),p.getFile(w.currentPath,"").then(function(e){w.fileList=[],""!=w.currentPath&&w.fileList.push({name:"..",lastModified:"",createdBy:"",size:"",type:"parent-dir",typeOrder:0}),e.forEach(function(e){"folder"===e.type?e.typeOrder=1:e.typeOrder=2,w.fileList.push(e)}),v(),console.log(w.currentPath)},function(e){l.stop({referenceId:"file-list"})})}function v(){w.tableParams=new u({sorting:{typeOrder:"asc",lastModified:"desc"}},{dataset:w.fileList}),l.stop({referenceId:"file-list"})}function y(e){p.deleteFile(e.path,e.name).then(function(t){"folder"!=e.type?m.deleteFile(e.key).then(function(t){e.textFileKey&&e.textFileKey!=e.key&&m.deleteFile(e.textFileKey),b(e._id),g.success("'"+e.name+"' was deleted successfully","","Success")}):(b(e._id),g.success("'"+e.name+"' was deleted successfully","","Success"))})}function b(e){var t=w.fileList.findIndex(function(t){return t._id===e});t>-1&&w.fileList.splice(t,1),v()}var w=this;w.pageId="file-browser-css",w.viewFile=function(e){if("folder"===e.type)"/"===e.path?w.currentPath=e.name:w.currentPath=e.path+"/"+e.name,w.pathsArray=w.currentPath.split("/"),a.path("files/"+w.currentPath);else if("parent-dir"===e.type)w.currentPath=w.currentPath.substr(0,w.currentPath.lastIndexOf("/")),w.pathsArray=w.currentPath.split("/"),a.path("files/"+w.currentPath);else{var n=t.open("about:blank","_blank");n.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),m.signDownload(e.path,e.name).then(function(e){if(setTimeout(function(){n.document.getElementById("loader").remove()},1e3),"doc"===e.type){var t="https://docs.google.com/viewer?url="+encodeURIComponent(e.url)+"&embedded=true";n.location=t}else n.location=e.url},function(){n.close()})}},w.confirmDelete=function(e){swal({title:"Are you sure?",html:!0,text:"<p>Confirm to delete '<strong>"+e.name+"</strong>'</p>",type:"warning",showCancelButton:!0,allowOutsideClick:!0,closeOnConfirm:!1,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){e.analyses.length>0?swal({title:"Are you positive?",html:!0,text:"<p>'<strong>"+e.name+"</strong>' is included in an analysis, are you still sure you want to delete this file?</p><br /><p>The analysis results will still be available.</p>",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes! delete it!"},function(){y(e)}):(y(e),swal.close())})},w.popupFileDetails=function(e){o.open({templateUrl:"/components/files/fileDetails/fileDetails.view.html",controller:"fileDetailsCtrl as vm",size:"lg",resolve:{file:function(){return e}}}).result.then(function(){b(e._id)},function(){})},w.getFileListS3=function(){m.getFileList().then(function(e){doListFilesS3(e.Contents)})},w.popupUploadFile=function(){var e=o.open({templateUrl:"/components/files/filesUpload/filesUpload.view.html",controller:"filesUploadCtrl as vm",size:"xl",backdrop:"static",openedClass:"upload-modal",resolve:{currentPath:function(){return w.currentPath}}});e.rendered.then(function(){}),e.result.then(function(e){e.typeOrder=2,w.fileList.push(e),v()},function(e){})},w.newFolder=function(){swal({title:"New Folder",text:"Please enter a name for this folder",type:"input",confirmButtonColor:"var(--main-colour)",showCancelButton:!0,closeOnConfirm:!1,allowOutsideClick:!0,animation:"slide-from-top",inputPlaceholder:"New Folder"},function(e){if(!1===e)return!1;if(""===e)return swal.showInputError("You need to write something!"),!1;var t={name:e,path:w.currentPath,type:"folder",createdBy:f.currentUser().firstName,icon:"fa fa-folder-o"};p.addFile(t).then(function(e){swal.close(),g.success(t.name+" folder successfully created","","Success"),e.typeOrder=1,w.fileList.push(e),v()})})},w.openFolder=function(e){for(var t="",n=0;n<e+1;n++)t+=w.pathsArray[n],n!=e&&(t+="/");w.currentPath=t,a.path("files/"+t)},w.fileList=[],w.currentPath=function(e,t){return null==e&&null==t?"":null==e?t:e+"/"+t}(n.folder,n.file),w.pathsArray=w.currentPath.split("/"),w.pageHeader={title:"Files"},h()}e.$inject=["$http","$window","$routeParams","$location","$scope","$uibModal","$filter","$compile","bsLoadingOverlayService","Upload","NgTableParams","mapService","filesService","authService","s3Service","logger"],angular.module("files").controller("filesBrowseCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o,i,s,l){var c=this;c.currentModalPage=1,n.rendered.then(function(){function u(){var e={center:[-34.4054039,150.87842999999998],zoom:4};c.map=L.map("map-files-page",e);var t="pk.eyJ1IjoiYWlkYW4yNzUiLCJhIjoiY2o0MWVrMmFxMGVuNjJxbnlocmV6ZDJ0cCJ9.h77mANND4PPZz9U1z4OC3w",n=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.light",accessToken:t,maxZoom:22}),a=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.dark",accessToken:t,maxZoom:22}),r=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.satellite",accessToken:t,maxZoom:22}),o=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-satellite",accessToken:t,maxZoom:22}),i=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.wheatpaste",accessToken:t,maxZoom:22}),s=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.streets-basic",accessToken:t,maxZoom:22}).addTo(c.map),l=(L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.comic",accessToken:t,maxZoom:22}),L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.outdoors",accessToken:t,maxZoom:22})),u=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.run-bike-hike",accessToken:t,maxZoom:22}),f=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pencil",accessToken:t,maxZoom:22}),m=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.pirates",accessToken:t,maxZoom:22}),h=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.emerald",accessToken:t,maxZoom:22}),v=L.tileLayer("https://api.mapbox.com/v4/{map}/{z}/{x}/{y}.png?access_token={accessToken}",{map:"mapbox.high-contrast",accessToken:t,maxZoom:22}),y=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"}),b=L.gridLayer.googleMutant({maxZoom:22,type:"satellite"}),w=L.gridLayer.googleMutant({maxZoom:22,type:"terrain"}),x=L.gridLayer.googleMutant({maxZoom:22,type:"hybrid"}),k=L.gridLayer.googleMutant({maxZoom:22,type:"roadmap"});k.addGoogleLayer("TrafficLayer"),L.control.layers({"Mapbox Light":n,"Mapbox Dark":a,"Mapbox Satellite":r,"Mapbox Streets Satellite":o,"Mapbox Wheatpaste":i,"Mapbox Streets Basic":s,"Mapbox Outdoors":l,"Mapbox Run Bike Hike":u,"Mapbox Pencil":f,"Mapbox Pirates":m,"Mapbox Emerald":h,"Mapbox High Contrast":v,"Google Roadmap":y,"Google Aerial":b,"Google Terrain":w,"Google Hybrid":x,"Google Traffic":k},{},{collapsed:!0}).addTo(c.map),c.posMarker=L.marker([c.lat,c.lng],{icon:z,draggable:!0,zIndexOffset:1e3}).addTo(c.map).bindTooltip("<strong>File Upload Position</strong>").bindPopup("<p>Drag me to change the file upload position</p>"),c.posMarker.on("drag",function(e){d(e)}),c.map.on("click",function(e){c.posMarker.setLatLng(e.latlng),d(e)}),p(),g()}function d(e){c.posMarkerMoved||(c.posMarkerMoved=!0,c.posMarker.setPopupContent("<p>Drag me to change the file upload position</p>")),c.lat=e.latlng.lat,c.lng=e.latlng.lng,t.$apply()}function p(e){c.map.on("locationfound",f),c.map.on("locationerror",m),c.map.locate({setView:!0,maxZoom:15})}function f(e){var t=e.latlng,n=e.accuracy/2;c.lat=t.lat,c.lng=t.lng,c.posMarker.setLatLng(t),c.posMarker.setPopupContent("\t<p>You are within "+a("formatDistance")(n)+" from this point<br />Drag me to change the file upload position</p>");var r=L.circle(t,{radius:n,color:"#cb2529"});c.posMarker.on("popupopen",function(){c.posMarkerMoved||(r.addTo(c.map),c.map.fitBounds(r.getBounds()))}),c.posMarker.on("popupclose",function(){c.posMarkerMoved||c.map.removeLayer(r)})}function m(e){l.error(e.message,e,"Error")}function g(){o.getFileList().then(function(e){c.fileList=e,h()})}function h(){c.markers=L.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:40}),c.fileList.forEach(function(e){var t,n=e.coords.coordinates[1],r=e.coords.coordinates[0];switch(e.type){case"file":t=L.marker([n,r],{icon:A});break;case"text":t=L.marker([n,r],{icon:M});break;case"doc":t=L.marker([n,r],{icon:I});break;case"pdf":t=L.marker([n,r],{icon:P});break;case"image":t=L.marker([n,r],{icon:F});break;case"video":t=L.marker([n,r],{icon:D});break;case"audio":t=L.marker([n,r],{icon:B});break;default:t=L.marker([n,r],{icon:T})}t.bindTooltip("<strong>File Name:</strong> "+e.name+"<br /><strong>Created By:</strong> "+e.createdBy+"<br /><strong>Last Modified:</strong> "+a("date")(e.lastModified,"dd MMMM, yyyy h:mm a")),t.on("click ",function(){c.posMarker.setLatLng([n,r]),d({latlng:{lat:n,lng:r}})}),c.markers.addLayer(t)}),c.map.addLayer(c.markers)}function v(){if(c.file)switch(c.fileInfo.extension){case"pdf":c.fileInfo.typeDB="pdf",c.fileInfo.icon="fa fa-file-pdf-o",y();break;case"docx":c.fileInfo.typeDB="doc",c.fileInfo.icon="fa fa-file-word-o",b();break;case"doc":c.fileInfo.typeDB="doc",c.fileInfo.icon="fa fa-file-word-o";break;case"txt":c.fileInfo.typeDB="text",c.fileInfo.icon="fa fa-file-text-o",c.fileInfo.isTxtFile=!0;break;case"gif":case"jpg":case"jpeg":case"png":case"bmp":case"tif":c.fileInfo.typeDB="image",c.fileInfo.icon="fa fa-file-image-o";break;case"mkv":case"mp4":case"avi":case"mov":case"movie":case"mpe":case"mpeg":case"mpg":case"dvi":c.fileInfo.typeDB="video",c.fileInfo.icon="fa fa-file-video-o";break;case"mp3":case"m4a":case"mpa":c.fileInfo.typeDB="audio",c.fileInfo.icon="fa fa-file-audio-o";break;default:c.fileInfo.typeDB="file",c.fileInfo.icon="fa fa-file-o"}else l.error("Please select a file to upload.","","Error")}function y(){function e(e){return PDFJS.getDocument({data:e}).then(function(e){for(var t=e.pdfInfo.numPages,n=[],a=1;a<=t;a++){var r=e.getPage(a);n.push(r.then(function(e){return e.getTextContent().then(function(e){return e.items.map(function(e){return e.str}).join("")})}))}return Promise.all(n).then(function(e){return e.join("")})})}c.isProcessing=!0;var t=new FileReader;t.onload=function(){e(this.result).then(function(e){w(e)},function(e){l.error(e.message,e,"Error"),c.modal.close()})},t.readAsArrayBuffer(c.file)}function b(){c.isProcessing=!0;var e=new DocxJS;e.parse(c.file,function(){e.getPlainText(function(e){w(e)})},function(e){l.error(e.msg,e,"Error"),c.modal.close()})}function w(e){c.textFile=new File([e],c.fileInfo.name,{type:"text/plain; charset=utf-8"}),c.textFileInfo={extension:"txt",type:c.textFile.type,group:"text-data"},c.isProcessing=!1,t.$apply()}function x(){s.signUpload(c.textFileInfo).then(function(e){r.upload({method:"POST",url:e.url,fields:e.fields,file:c.textFile}).then(function(t){c.fileInfo.key=e.baseKey+"."+c.fileInfo.extension,c.textFileInfo.key=e.fields.key,k()},function(e){var t=$.parseXML(e.data);C(!1,"error"),l.error($(t).find("Message").text(),"","Error"),c.modal.close()})},function(e){C(!1,"error"),c.modal.close()})}function k(){s.signUpload(c.fileInfo).then(function(t){r.upload({method:"POST",url:t.url,fields:t.fields,file:c.file}).progress(function(e){c.currentPercentage=parseInt(100*e.loaded/e.total)}).then(function(n){$.parseXML(n);var a=c.tags.map(function(e){return e.text}),r=t.fields.key,s=t.url+"/"+r,u={name:c.fileInfo.name+"."+c.fileInfo.extension,path:e,type:c.fileInfo.typeDB,key:r,size:c.file.size,url:s,createdBy:i.currentUser().firstName,coords:{lat:c.lat,lng:c.lng},tags:a,icon:c.fileInfo.icon};c.textFileInfo.key&&(u.textFileKey=c.textFileInfo.key),c.fileInfo.isTxtFile&&(u.textFileKey=r),o.addFile(u).then(function(e){C(!1,"success"),l.success(e.name+" successfully uploaded","","Success"),setTimeout(function(){c.modal.close(e)},1e3)})},function(e){C(!1,"error");var t=$.parseXML(e.data);l.error($(t).find("Message").text(),"","Error"),c.modal.close()})},function(e){C(!1,"error"),c.modal.close()})}function C(e,t){c.isSubmittingButton=e,c.resultButton=t,c.isProcessing=e}""===e&&(e="/"),c.onFileSelect=function(e){e.length>0&&(e[0].size<10485760?(c.file=e[0],c.fileInfo={name:c.file.name.replace(/\.[^/.]+$/,""),extension:c.file.name.split(".").pop().toLowerCase(),type:c.file.type,group:"file"},"text/plain"===c.fileInfo.type&&(c.fileInfo.type="text/plain; charset=utf-8"),v(),c.currentModalPage=2,setTimeout(function(){c.map.invalidateSize(),c.map.setView(c.posMarker.getLatLng(),15)},100)):(l.error("Maximum file size is 10 MB. \nPlease select a smaller file.","","Error"),c.file=null,c.fileInfo={},document.getElementById("file-input").value=""))},c.uploadFile=function(){c.fileInfo.name?(C(!0,null),c.textFile?x():k()):l.error("Please enter a file name","","Error")},c.changeModalPage=function(e){c.currentModalPage=e,2===e&&setTimeout(function(){c.map.invalidateSize(),c.map.setView(c.posMarker.getLatLng(),c.map.getZoom())},100)},c.currentPath=e,c.map=null,c.marker=null,c.markers={},c.posMarker=null,c.posMarkerMoved=!1,c.lat=-34.4054039,c.lng=150.87842999999998,c.currentUser=i.currentUser(),c.tags=[],c.fileList=[],c.currentPercentage="0",c.file=null,c.fileInfo={},c.textFile=null,c.textFileInfo={},c.isSubmittingButton=null,c.resultButton=null,c.uploadButtonOptions={buttonDefaultText:"Upload",animationCompleteTime:1e3,buttonSubmittingText:"Uploading...",buttonSuccessText:"Done!"},c.isProcessing=!1;var S=L.Icon.extend({options:{shadowUrl:"assets/img/map/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12.5,41],shadowAnchor:[12.5,41],popupAnchor:[0,-50]}}),T=new S({iconUrl:"assets/img/map/markers/marker-icon-2x.png"}),A=new S({iconUrl:"assets/img/map/markers/File-Marker.png"}),M=new S({iconUrl:"assets/img/map/markers/Txt-Marker.png"}),I=new S({iconUrl:"assets/img/map/markers/Word-Marker.png"}),P=new S({iconUrl:"assets/img/map/markers/PDF-Doc-Marker.png"}),F=new S({iconUrl:"assets/img/map/markers/Image-Marker.png"}),D=new S({iconUrl:"assets/img/map/markers/Video-Marker.png"}),B=new S({iconUrl:"assets/img/map/markers/Audio-Marker.png"}),z=new S({iconUrl:"assets/img/map/markers/upload-marker.png"}),z=new S({iconUrl:"assets/img/map/markers/upload-marker.png",iconSize:[50,62],shadowSize:[80,80],iconAnchor:[25,62],shadowAnchor:[25,80]});u(),c.modal={close:function(e){n.close(e)},cancel:function(){n.dismiss("cancel")}}})}e.$inject=["currentPath","$scope","$uibModalInstance","$filter","Upload","filesService","authService","s3Service","logger"],angular.module("files").controller("filesUploadCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r){function o(){var t={_creator:i.currentUser._id,name:i.formData.name,description:i.formData.description,precedent:e.precedent,dependent:e.dependent};n.putLink(t).then(function(e){r.success("The dependecy has been save","","Success"),i.modal.close(e)})}var i=this;i.onSubmit=function(){i.formData.name&&i.formData.description?o():r.error("All fields required, please try again","","Error")},i.currentUser=a.currentUser(),i.formData={},i.modal={close:function(e){t.close(e)},cancel:function(){t.dismiss("cancel")}}}e.$inject=["markers","$uibModalInstance","mapService","authService","logger"],angular.module("map").controller("linkInfoCtrl",e)}(),function(){function e(e,t,n,a,r,o,i,s,l,c){function u(){i.getUserInfo(e).then(function(e){r.stop({referenceId:"user-info"}),h.userInfo=e},function(e){r.stop({referenceId:"user-info"})})}function d(){m(!0,null),h.file?p():f()}function p(){l.signUpload(h.fileInfo).then(function(e){o.upload({method:"POST",url:e.url,fields:e.fields,file:h.file}).then(function(t){console.log("Avatar successfully uploaded to S3");$.parseXML(t);var n=e.fields.key;h.userInfo.avatar=e.url+"/"+encodeURIComponent(n),f()},function(e){m(!1,"error");var t=$.parseXML(e.data);c.error($(t).find("Message").text(),"","Error"),g()})},function(e){m(!1,"error")})}function f(){i.updateProfile(h.userInfo).then(function(e){s.saveToken(e),m(!1,"success"),console.log("Successfully updated profile"),c.success("Successfully updated profile","","Success"),g(),setTimeout(function(){h.modal.close(e)},1e3)})}function m(e,t){h.isSubmittingButton=e,h.resultButton=t,h.isProcessing=e}function g(){h.file=null,h.fileInfo={},h.textFile={},h.textFileInfo={},document.getElementById("file-upload-input").value=""}var h=this;h.getUserInfo=u,h.onAvatarSelect=function(e){if(e.length>0)if(h.file=e[0],h.file.size<10485760){var t=h.file.name.split(".").pop().toLowerCase();switch(t){case"gif":case"jpg":case"jpeg":case"png":case"bmp":h.file=e[0],h.fileInfo={extension:t,type:h.file.type,readType:"public-read",group:"avatar"};var n=new FileReader;n.onload=function(e){document.getElementById("upload-avatar-container").style.backgroundImage="url('"+e.target.result+"')",document.getElementById("upload-avatar").src=e.target.result},n.readAsDataURL(h.file);break;default:c.error("The selected file is not a supported image file","","Error"),g()}}else c.error("Maximum file size is 10 MB. \nPlease select a smaller file.","","Error"),g()},h.onSubmit=function(){h.userInfo.firstName?h.userInfo.lastName?h.userInfo.email?!h.userInfo.password&&h.profileForm.password.$dirty?c.error("Please enter a password","","Error"):!h.userInfo.confirmPassword&&h.profileForm.confirmPassword.$dirty?c.error("Please confirm your password","","Error"):""===h.userInfo.password||""===h.userInfo.confirmPassword?c.error("Password cannot be blank","","Error"):h.userInfo.password!=h.userInfo.confirmPassword?c.error("Passwords do not match","","Error"):d():c.error("Please enter a valid email address","","Error"):c.error("Please enter your last name","","Error"):c.error("Please enter your first name","","Error")},h.togglePassword=function(){!1===h.changePassword?h.changePassword=!0:(h.changePassword=!1,h.userInfo.confirmPassword=null,h.userInfo.password=null,h.profileForm.confirmPassword.$setPristine(),h.profileForm.password.$setPristine())},h.userInfo={},h.isSubmittingButton=null,h.resultButton=null,h.saveProfileButtonOptions={buttonDefaultText:"Save Profile",animationCompleteTime:1e3,buttonSubmittingText:"Saving...",buttonSuccessText:"Done!"},h.isProcessing=!1,h.changePassword=!1,r.start({referenceId:"user-info"}),u(),h.modal={close:function(){n.close()},cancel:function(){n.dismiss("cancel")}}}e.$inject=["userEmail","$scope","$uibModalInstance","$animate","bsLoadingOverlayService","Upload","usersService","authService","s3Service","logger"],angular.module("settings").controller("editProfileCtrl",e)}(),function(){angular.module("settings").controller("knowledgebaseCtrl",function(){var e=this;e.pageId="knowledgebase-css",e.toggleOptions=function(){if(t.toggle())return!0},e.togglePage=function(t){switch(e.knowledgebase=!1,e.terminology=!1,e.uploading=!1,e.datasets=!1,e.analysis=!1,e.visualisations=!1,e.map=!1,e.system=!1,t){case"knowledgebase":e.knowledgebase=!0;break;case"terminology":e.terminology=!0;break;case"uploading":e.uploading=!0;break;case"datasets":e.datasets=!0;break;case"analysis":e.analysis=!0;break;case"visualisations":e.visualisations=!0;break;case"map":e.map=!0;break;case"system":e.system=!0;break;default:e.knowledgebase=!0}},e.pageHeader={title:"Knowledgebase",strapline:"learn how to use the system"},e.knowledgebase=!0,e.terminology=!1,e.uploading=!1,e.datasets=!1,e.analysis=!1,e.visualisations=!1,e.map=!1,e.system=!1;var t=new Slideout({panel:document.querySelector("#kbPanel"),menu:document.querySelector("#kbMenu"),padding:256,tolerance:70})})}(),function(){"use strict";function e(e,t,n,a,r){function o(){a.getAllUsersInfo().then(function(e){c.userList=e,i()},function(e){n.stop({referenceId:"user-list"})})}function i(){c.tableParams=new t({sorting:{lastModified:"desc"}},{dataset:c.userList}),n.stop({referenceId:"user-list"})}function s(e){a.deleteUser(e.email).then(function(t){l(e._id),r.success("'"+e.firstName+"' was deleted successfully","","Success")})}function l(e){var t=c.userList.findIndex(function(t){return t._id===e});t>-1&&c.userList.splice(t,1),i()}var c=this;c.pageId="user-management",c.popupNewUser=function(){e.open({templateUrl:"/components/settings/userManagement/registerNewUser/registerNewUser.view.html",controller:"registerNewUserCtrl as vm",size:"xl"}).result.then(function(e){c.userList.push(e),i()})},c.popupEditUser=function(t){e.open({templateUrl:"/components/settings/userManagement/editUser/editUser.view.html",controller:"editUserCtrl as vm",size:"lg",resolve:{user:function(){return t}}}).result.then(function(e){})},c.confirmDelete=function(e){swal({title:"Are you sure?",html:!0,text:"<p>Confirm to delete the user '<strong>"+e.firstName+"</strong>'</p>",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete user!"},function(){s(e)})},c.userList=[],c.pageHeader={title:"User Management",strapline:"manage users of the system"},n.start({referenceId:"user-list"}),o()}e.$inject=["$uibModal","NgTableParams","bsLoadingOverlayService","usersService","logger"],angular.module("settings").controller("userManagementCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(n){t.checkSurvey(n).then(function(t){e.path("/complete-survey/"+n)},function(e){})}var r=this;r.pageId="enter-code-css",r.onSubmit=function(){if(!r.surveyCode)return n.error("All fields required, please try again","","Error"),!1;a(r.surveyCode)},r.surveyCode="",r.surveyFound=!1,r.surveyComplete=!1}e.$inject=["$location","surveyService","logger"],angular.module("survey").controller("surveyEnterCodeCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o){function i(){r.readSurveyJSON(d).then(function(e){u.surveyJSON=e},function(){t.path("/complete-survey")})}function s(e){c(!1,"success"),u.form.latitude=e.coords.latitude,u.form.longitude=e.coords.longitude}function l(){Survey.Survey.cssType="bootstrap",Survey.defaultBootstrapCss.navigationButton="btn btn-green";var e=JSON.parse(u.surveyJSON);window.survey=new Survey.Model(e),survey.onComplete.add(function(e){u.surveyComplete=!0;var t={fullName:u.form.fullName,email:u.form.email,gender:u.form.gender,age:u.form.age,accessId:d,responseJSON:JSON.stringify(e.data),coords:{lat:null,lng:null}};u.form.location&&u.form.latitude&&u.form.longitude&&(t.coords.lat=u.form.latitude,t.coords.lng=u.form.longitude),u.surveyComplete&&r.saveSurveyResponse(t).then(function(e){o.success("Survey saved successfully.\nThank you for participating.","","Success")})}),survey.render("surveyElement")}function c(e,t){u.isSubmittingButton=e,u.resultButton=t,u.isProcessing=e}var u=this,d=e.accessId;u.onSubmit=function(){null==!u.form.fullName?o.error("Please enter your full name","","Error"):u.form.gender?u.form.age?(u.userFormComplete=!0,l()):o.error("Please enter your age","","Error"):o.error("Please select your gender","","Error")},u.getLocation=function(){u.form.location&&(c(!0,null),a.getCurrentPosition().then(s,function(e){o.error("Geoloation failed","","Error"),c(!1,"error")}))},u.surveyJSON,u.userFormComplete=!1,u.surveyComplete=!1,u.form=angular.element(surveyElement),u.isSubmittingButton=null,u.resultButton=null,u.geolocateButtonOptions={buttonDefaultText:"Continue",animationCompleteTime:1e3,buttonSubmittingText:"Finding location...",buttonSuccessText:"Location Found!"},u.isProcessing=!1,i()}e.$inject=["$routeParams","$location","bsLoadingOverlayService","geolocationSvc","surveyService","logger"],angular.module("survey").controller("surveyCompleteCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var r={showEmbededSurveyTab:!1,showTestSurveyTab:!0,showJSONEditorTab:!1,showOptions:!1,generateValidJSON:!0},o=new SurveyEditor.SurveyEditor("surveyEditorContainer",r);o.saveSurveyFunc=function(){swal({title:"Save Survey",text:"Please enter a name for this survey",type:"input",confirmButtonColor:"#5cb85c",showCancelButton:!0,closeOnConfirm:!1,allowOutsideClick:!0,animation:"slide-from-top",inputPlaceholder:"Survey Name"},function(r){if(!1===r)return!1;if(""===r)return swal.showInputError("You need to write something!"),!1;var i={surveyJSON:o.text,name:r,createdBy:a.currentUser().firstName};n.saveSurvey(i).then(function(n){swal({title:"Saved!",text:"Survey saved as '"+r+"'\nThis survey's code is "+n.accessId,type:"success",confirmButtonColor:"#5cb85c",animation:"slide-from-top"},function(){t.path("/survey"),e.$apply()})})})}}e.$inject=["$scope","$location","surveyService","authService"],angular.module("survey").controller("surveyCreateCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(){n.readSurvey(r).then(function(e){var t=JSON.parse(e.surveyJSON);window.survey=new Survey.Model(t),survey.onComplete.add(function(e){document.querySelector("#surveyResult").innerHTML="result: "+JSON.stringify(e.data)}),survey.mode="display",n.readOneSurveyResponse(r,o).then(function(e){var t=JSON.parse(e.responseJSON);survey.data=t,survey.render("surveyElement")})})}var r=e.accessId,o=e.responseId;Survey.Survey.cssType="bootstrap",Survey.defaultBootstrapCss.navigationButton="btn btn-green",a()}e.$inject=["$routeParams","$filter","surveyService"],angular.module("survey").controller("surveyResponseCtrl",e)}(),function(){"use strict";function e(e,t,n,a,r,o){function i(){r.readSurveyResponses(u.accessId).then(function(e){e.responses.forEach(function(e){var t={responseJSON:JSON.parse(e.responseJSON),dateCreated:e.dateCreated,fullName:e.fullName,email:e.email,age:e.age,gender:e.gender,id:e._id,coords:{lat:e.coords.coordinates[1],lng:e.coords.coordinates[0]}};t.coords.lat&&t.coords.lng?t.location=!0:t.location=!1,u.surveyResponsesList.push(t)}),s()},function(e){n.stop({referenceId:"survey-responses"})})}function s(){u.tableParams=new a({sorting:{dateCreated:"desc"}},{dataset:u.surveyResponsesList}),n.stop({referenceId:"survey-responses"})}function l(e){c(e),o.success("The survey response was deleted successfully","","Success")}function c(e){var t=u.surveyResponsesList.findIndex(function(t){return t._id===e});t>-1&&u.surveyResponsesList.splice(t,1),s()}var u=this;u.pageId="survey-page-css",u.accessId=t.accessId,u.confirmDelete=function(e){swal({title:"Are you sure?",text:"Confirm to delete this survey response",type:"warning",showCancelButton:!0,allowOutsideClick:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Yes, delete it!"},function(){l(e)})},u.goToResponseUrl=function(t){e.path("survey/responses/"+u.accessId+"/"+t)},u.pageHeader={title:"Survey Responses",strapline:"lists of what people think"},u.surveyResponsesList=[],n.start({referenceId:"survey-responses"}),i()}e.$inject=["$location","$routeParams","bsLoadingOverlayService","NgTableParams","surveyService","logger"],angular.module("survey").controller("surveyResponseListCtrl",e)}(),function(){"use strict";function e(e,t){var n=e.accessId;Survey.Survey.cssType="bootstrap",Survey.defaultBootstrapCss.navigationButton="btn btn-green",t.readSurvey(n).then(function(e){var t=JSON.parse(e.surveyJSON);window.survey=new Survey.Model(t),survey.onComplete.add(function(e){document.querySelector("#surveyResult").innerHTML="result: "+JSON.stringify(e.data)}),survey.render("surveyElement")})}e.$inject=["$routeParams","surveyService"],angular.module("survey").controller("surveyViewCtrl",e)}(),function(){angular.module("directives").directive("footerGeneric",function(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}})}(),function(){function e(e,t,n,a){var r=this;r.logout=function(){t.logout({email:o,desc:"Logout"}),e.path("/login")},r.popupEditProfile=function(e){n.open({templateUrl:"/components/settings/editProfile/editProfile.view.html",controller:"editProfileCtrl as vm",size:"xl",resolve:{userEmail:function(){return e}}}).result.then(function(){r.currentUser=t.currentUser()})},r.currentPath=e.path(),r.isLoggedIn=t.isLoggedIn(),r.currentUser=t.currentUser();var o=r.currentUser.email}e.$inject=["$location","authService","$uibModal","$scope"],angular.module("directives").controller("navigationCtrl",e)}(),function(){angular.module("directives").directive("navigation",function(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}})}(),function(){angular.module("directives").directive("pageHeader",function(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}})}(),function(){"use strict";function e(e,t,n,a,r,o,i,s,l,c,u,d){function p(){y.selectedPathName=[],y.selectedKeys=Object.keys(y.selectedFiles).filter(function(e){return y.selectedFiles[e]}),y.selectedKeys.forEach(function(e){var t=y.allFilesSoFar.findIndex(function(t){return t.textFileKey==e});y.selectedPathName.push(y.allFilesSoFar[t])})}function f(){i.start({referenceId:"new-dataset"}),l.getFile(y.currentPath,"","true").then(function(e){e.forEach(function(e){y.allFilesSoFar.pushIfNotExist(e,function(t){return t._id===e._id})}),y.fileList=e.map(function(e){return"folder"===e.type?e.typeOrder=1:e.typeOrder=2,e}),""!=y.currentPath&&y.fileList.push({name:"..",lastModified:"",createdBy:"",size:"",type:"parent-dir",typeOrder:0}),m()},function(e){i.stop({referenceId:"new-dataset"})})}function m(){y.tableParams=new o({sorting:{typeOrder:"asc",lastModified:"desc"}},{dataset:y.fileList}),i.stop({referenceId:"new-dataset"})}function g(){var e=0,t="";y.selectedKeys.forEach(function(n){u.signDownloadKey(n).then(function(n){l.downloadFile(n).then(function(n){t+=n+"\n\n",++e===y.selectedKeys.length&&h(new File([t],y.formData.datasetName,{type:"text/plain; charset=utf-8"}))},function(e){v(!1,"error")})},function(e){v(!1,"error")})})}function h(e){u.signUpload({name:e.name,extension:"txt",type:"text/plain; charset=utf-8",group:"dataset"}).then(function(t){r.upload({method:"POST",url:result.data.url,fields:result.data.fields,file:e}).then(function(t){var n=result.data.fields.key,a=result.data.url+"/"+n;s.datasetCreate({name:y.formData.datasetName,desc:y.formData.description,size:e.size,key:n,url:a,createdBy:c.currentUser().firstName,files:y.datasetFiles}).then(function(e){v(!1,"success"),d.success('Dataset "'+y.formData.datasetName+'" was created successfully',"","Success"),setTimeout(function(){y.modal.close(t)},1e3)})},function(e){v(!1,"error");var t=$.parseXML(e.data);d.error($(t).find("Message").text(),"","Error")})},function(e){v(!1,"error")})}function v(e,t){y.isSubmittingButton=e,y.resultButton=t,y.isProcessing=e,"error"===t&&setTimeout(function(){y.modal.cancel(data)},1e3)}var y=this;y.onSubmit=function(){v(!0,null),angular.isDefined(y.formData)&&y.formData.datasetName&&y.formData.description?y.selectedKeys.length<2?d.error("Please select at least two files to create a dataset","","Error"):g():d.error("All fields required, please try again","","Error")},y.viewFile=function(e,t){if("folder"===e.type)"/"===e.path?y.currentPath=e.name:y.currentPath=e.path+"/"+e.name,y.pathsArray=y.currentPath.split("/"),f();else if("parent-dir"===e.type)y.currentPath=y.currentPath.substr(0,y.currentPath.lastIndexOf("/")),y.pathsArray=y.currentPath.split("/"),f();else if(t)y.selectedFiles[e.textFileKey]=!y.selectedFiles[e.textFileKey],p();else{var a=n.open("about:blank","_blank");a.document.write('<style>#loader{position: absolute;left: 50%;top: 50%;border:0.5em solid rgba(70, 118, 250, 0.2);border-radius:50%;border-top:0.5em solid #4676fa;width:75px;height:75px;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite;}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);}}@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style><div id="loader"></div>'),u.signDownload(e.path,e.name,"true").then(function(e){setTimeout(function(){a.document.getElementById("loader").remove()},1e3),a.location=e.url},function(){a.close()})}},y.updateSelected=p,y.formData,y.currentPath="",y.fileList=[],y.allFilesSoFar=[],y.selectedFiles=[],y.selectedPathName=[],y.selectedKeys=[],y.isSubmittingButton=null,y.resultButton=null,y.createButtonOptions={buttonDefaultText:"Create Dataset",animationCompleteTime:1e3,buttonSubmittingText:"Processing...",buttonSuccessText:"Done!"},y.isProcessing=!1,Array.prototype.inArray=function(e){for(var t=0;t<this.length;t++)if(e(this[t]))return!0;return!1},Array.prototype.pushIfNotExist=function(e,t){this.inArray(t)||this.push(e)},f(),y.modal={close:function(e){a.close(e)},cancel:function(){a.dismiss("cancel")}}}e.$inject=["$scope","$http","$window","$uibModalInstance","Upload","NgTableParams","bsLoadingOverlayService","datasetService","filesService","authService","s3Service","logger"],angular.module("datasets").controller("newDatasetCtrl",e)}(),function(){function e(e,t){this.modal={close:function(){e.close()},cancel:function(){e.dismiss("cancel")}}}e.$inject=["$uibModalInstance","datasetService"],angular.module("datasets").controller("editDatasetCtrl",e)}(),function(){function e(e,t,n,a,r){function o(){a.datasetReadOne(e).then(function(e){i.dataset=e,i.dataset.files.forEach(function(e){var t=e.substring(e.indexOf("-")+1),n={};n.key=e,n.name=t,i.files.push(n)})})}var i=this;i.viewFile=function(e){r.signDownloadKey(e).then(function(e){t.open(e,"_blank")})},i.files=[],o(),i.modal={close:function(){n.close()},cancel:function(){n.dismiss("cancel")}}}e.$inject=["datasetId","$window","$uibModalInstance","datasetService","s3Service"],angular.module("datasets").controller("viewDatasetCtrl",e)}(),function(){function e(e,t,n,a,r){function o(){var t={email:e.email,isAdmin:i.isAdmin};n.updateProfile(t).then(function(e){r.success("Successfully updated user settings","","Success"),setTimeout(function(){i.modal.close(e)},1e3)})}var i=this;i.onSubmit=function(){if(!i.isAdmin)return r.error("All fields required, please try again","","Error"),!1;o()},i.isAdmin="",i.modal={close:function(){t.close()},cancel:function(){t.dismiss("cancel")}}}e.$inject=["user","$uibModalInstance","usersService","authService","logger"],angular.module("settings").controller("editUserCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(){t.createUser(r.credentials).then(function(e){n.success("New user created successfully","","Success"),r.modal.close(e)})}var r=this;r.onSubmit=function(){if(!(r.credentials.password&&r.credentials.email&&r.credentials.firstName&&r.credentials.lastName))return n.error("Missing fields required, please try again","","Error"),!1;a()},r.credentials={password:"",email:"",firstName:"",lastName:"",company:""},r.pageHeader={title:"Create a new NativeQDA account"},r.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}e.$inject=["$uibModalInstance","usersService","logger"],angular.module("settings").controller("registerNewUserCtrl",e)}(),function(){function e(e,t,n,a){function r(){f.length>10?((m=f.slice(f.length-10,f.length)).reverse(),s(m)):(f.reverse(),s(f))}function o(){f.sort(function(e,t){return e.relevance-t.relevance})}function i(){f.sort(function(e,t){return e.count-t.count})}function s(e){var t=d3.select("#barPanel").append("div").attr("class","bar-chart-tooltip").style("opacity",0).style("background","#fff").style("padding","10px").style("border-radius","10px").style("font-weight",600),n=d3.scaleBand().rangeRound([0,h]).padding(.1),a=d3.scaleLinear().rangeRound([v,0]),r=d3.scaleOrdinal().range(["#6F257F","CA0D59"]);b=y.append("g").attr("transform","translate("+h/3+", "+v/4+") scale(0.4)"),n.domain(e.map(function(e){return e.text})),a.domain([0,d3.max(e,function(e){return e.relevance})]),b.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+v+")").call(d3.axisBottom(n).ticks(10)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)"),b.append("g").attr("class","axis axis--y").call(d3.axisLeft(a).ticks(10,"%")).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Relevance"),b.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(e){return n(e.text)}).attr("y",function(e){return a(e.relevance)}).attr("width",n.bandwidth()).attr("height",function(e){return v-a(e.relevance)}).attr("fill",function(e){return r(e.area)}).on("mousemove",function(e){t.transition().duration(200).style("opacity",.9),t.html(e.text+"<br>"+d3.format(".2%")(e.relevance)).style("left",h/2+"px").style("transform","translate(-50%, 0)").style("top","10px").style("background","#fafafa").style("border","1px solid #000")}).on("mouseout",function(e){t.transition().duration(500).delay(3e3).style("opacity",0)})}function l(){var e=d3.scaleOrdinal().range([u.barColour,u.barColour]);y.selectAll(".bar").style("fill",function(t){return e(t.relevance)})}function c(e){var t=d3.select("#barPanel").append("div").attr("class","bar-chart-tooltip").style("opacity",0).style("background","#fff").style("padding","10px").style("border-radius","10px").style("font-weight",600),n=d3.scaleBand().rangeRound([0,h]).padding(.1),a=d3.scaleLinear().rangeRound([v,0]),r=d3.scaleOrdinal().range(["#6F257F","CA0D59"]);b=y.append("g").attr("transform","translate("+h/3+", "+v/4+") scale(0.4)"),n.domain(e.map(function(e){return e.text})),a.domain([0,d3.max(e,function(e){return e.count})]),b.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+v+")").call(d3.axisBottom(n).ticks(5)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)"),b.append("g").attr("class","axis axis--y").call(d3.axisLeft(a).ticks(10)).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Relevance"),b.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(e){return n(e.text)}).attr("y",function(e){return a(e.count)}).attr("width",n.bandwidth()).attr("height",function(e){return v-a(e.count)}).attr("fill",function(e){return r(e.area)}).on("mousemove",function(e){t.transition().duration(200).style("opacity",.9),t.html(e.text+"<br>"+e.count).style("left",h/2+"px").style("transform","translate(-50%, 0)").style("top","10px").style("background","#fafafa").style("border","1px solid #000")}).on("mouseout",function(e){t.transition().duration(500).delay(3e3).style("opacity",0)})}var u=this,d=e.type,p=e.id,f=[],m=[];u.cols=[],u.top10=function(){o(),m=f.slice(0,10),redraw(m)},u.bottom10=function(){o(),m=f.slice(0,10),redraw(m)},u.setBarColour=l,u.toggleOptions=function(){g.toggle()};var g=new Slideout({panel:document.querySelector("#barPanel"),menu:document.querySelector("#barMenu"),padding:256,tolerance:70}),h=document.querySelector("#graph").clientWidth,v=document.querySelector("#graph").clientHeight,y=d3.select("#graph").append("svg").attr("width",h).attr("height",v).attr("class","graph-svg-component").call(d3.zoom().scaleExtent([.5,10]).translateExtent([[-h/2,-v/2],[1.5*h,1.5*v]]).on("zoom",function(){y.attr("transform",d3.event.transform)})).append("g");a.start({referenceId:"bar-chart"}),t.readWatsonAnalysis(p).then(function(e){var t=e;switch(d){case"concepts":t.concepts.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);f.push({relevance:e.relevance,text:t,dbpedia_resource:e.dbpedia_resource})}),o(),r();break;case"entities":t.entities.forEach(function(e){e.count;var t=e.text;f.push({count:e.count,text:t})}),i(),f.reverse(),c(f);break;case"keywords":t.keywords.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);f.push({relevance:e.relevance,text:t})}),o(),r()}},function(e){a.stop({referenceId:"bar-chart"})});var b;u.barColourChange={onChange:function(){l()}},u.textColourChange={onChange:function(e,t,n){y.selectAll("text").style("fill",t)}}}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("visualisations").controller("barChartCtrl",e)}(),function(){function e(e,t,n,a){function r(){p.length>10?((f=p.slice(p.length-10,p.length)).reverse(),i(f)):(p.reverse(),i(p))}function o(){p.sort(function(e,t){return e.relevance-t.relevance})}function i(e){var t=0,n=[],a=0;e.forEach(function(e){t+=e.relevance,n[a]=e.relevance,a++}),a=0,e.forEach(function(e){n[a]=t/e.relevance,e.relevance=n[a],a++}),s(e)}function s(e){var t=l(e).width(960).height(500).cornerRadius(3).padAngle(.015).variable(e.relevance).category(e.text);d3.select("#chart").datum(e).call(t)}function l(e){function t(e){e.each(function(t){function r(e){return e.startAngle+(e.endAngle-e.startAngle)/2}function o(e){var t="",n=0;for(var a in e.data){var r=isNaN(parseFloat(e.data[a]))?e.data[a]:d(e.data[a]);t+=0===n?'<tspan x="0">'+a+": "+r+"%</tspan>":'<tspan x="0" dy="1.2em">'+r+"</tspan>",n++}return t}var p=Math.min(n,a)/2,f=d3.pie().value(function(e){return u(e.relevance)}).sort(null),m=d3.arc().outerRadius(.8*p).innerRadius(.6*p).cornerRadius(s).padAngle(i),g=d3.arc().outerRadius(.9*p).innerRadius(.9*p),h=e.append("svg").attr("width",n+l.left+l.right).attr("height",a+l.top+l.bottom).append("g").attr("transform","translate("+n/2+","+a/2+")");h.append("g").attr("class","slices"),h.append("g").attr("class","labelName"),h.append("g").attr("class","lines");h.select(".slices").datum(t).selectAll("path").data(f).enter().append("path").attr("fill",function(e){return c(e.data.text)}).attr("d",m),h.select(".labelName").selectAll("text").data(f).enter().append("text").attr("dy",".35em").html(function(e){return e.data.text+": <tspan>"+d(e.data.relevance)+"%</tspan>"}).attr("transform",function(e){var t=g.centroid(e);return t[0]=.95*p*(r(e)<Math.PI?1:-1),"translate("+t+")"}).style("text-anchor",function(e){return r(e)<Math.PI?"start":"end"}),h.select(".lines").selectAll("polyline").data(f).enter().append("polyline").attr("points",function(e){var t=g.centroid(e);return t[0]=.95*p*(r(e)<Math.PI?1:-1),[m.centroid(e),g.centroid(e),t]});d3.selectAll(".labelName text, .slices path").call(function(e){e.on("mouseenter",function(e){h.append("text").attr("class","toolCircle").attr("dy",-15).html(o(e)).style("font-size",".9em").style("text-anchor","middle"),h.append("circle").attr("class","toolCircle").attr("r",.55*p).style("fill",c(e.data.text)).style("fill-opacity",.35)}),e.on("mouseout",function(){d3.selectAll(".toolCircle").remove()})})})}var n,a,r,o,i,s,l={top:10,right:10,bottom:10,left:10},c=d3.scaleOrdinal(d3.schemeCategory20c),u=d3.format(".4r"),d=d3.format(".3n");return t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(a=e,t):a},t.margin=function(e){return arguments.length?(l=e,t):l},t.radius=function(e){return arguments.length?(radius=e,t):radius},t.padAngle=function(e){return arguments.length?(i=e,t):i},t.cornerRadius=function(e){return arguments.length?(s=e,t):s},t.colour=function(e){return arguments.length?(c=e,t):c},t.variable=function(e){return arguments.length?(r=e,t):r},t.category=function(e){return arguments.length?(o=e,t):o},t}var c=this,u=e.type,d=e.id,p=[];analysisData=[];var f=[];a.start({referenceId:"donut-chart"}),t.readWatsonAnalysis(d).then(function(e){switch(u){case"concepts":e.concepts.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);p.push({relevance:e.relevance,text:t,dbpedia_resource:e.dbpedia_resource})}),o(),r();break;case"keywords":e.keywords.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);p.push({relevance:e.relevance,text:t})}),o(),r()}},function(e){a.stop({referenceId:"donut-chart"})});var m=new Slideout({panel:document.querySelector("#donutPanel"),menu:document.querySelector("#donutMenu"),padding:256,tolerance:70});c.toggleOptions=function(){m.toggle()}}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("visualisations").controller("donutChartCtrl",e)}(),function(){function e(e,t,n,a){function r(){n.start({referenceId:"analysis-data-table"}),a.readWatsonCategories(p).then(function(e){n.stop({referenceId:"analysis-data-table"});var a=0;(f=e).categories.forEach(function(e){e.label=e.label||{},e.score=e.score||{};var t={id:a,label:e.label,score:e.score};m.push(t),a++}),u.cols=[{field:"label",filter:{label:"text"},show:!0,sortable:"label",title:"Label"},{field:"score",filter:{score:"number"},show:!0,sortable:"score",title:"Score"}],u.tableParams=new t({},{dataset:m})})}function o(){var e=0;f.concepts.forEach(function(t){t.text=t.text||{},t.relevance=t.relevance||{},t.dbpedia_resource=t.dbpedia_resource||{};var n={id:e,text:t.text,relevance:t.relevance,dbpedia_resource:t.dbpedia_resource};m.push(n),e++}),u.cols=[{field:"text",filter:{text:"text"},show:!0,sortable:"text",title:"Text"},{field:"relevance",filter:{relevance:"number"},show:!0,sortable:"relevance",title:"Relevance"},{field:"dbpedia_resource",filter:{dbpedia_resource:"number"},show:!0,sortable:"dbpedia_resource",title:"DBpedia Resource"}],u.tableParams=new t({},{dataset:m})}function i(){var e=0;f.entities.forEach(function(t){t.text=t.text||{},t.count=t.count||{},t.type=t.type||{},t.relevance=t.relevance||{},t.emotion=t.emotion||{},t.sentiment=t.sentiment||{};var n={id:e,text:t.text,count:t.count,type:t.type,relevance:t.relevance,anger:t.emotion.anger,disgust:t.emotion.disgust,fear:t.emotion.fear,joy:t.emotion.joy,sadness:t.emotion.sadness,sentiment:t.sentiment.score};m.push(n),e++}),u.cols=[{field:"text",filter:{text:"text"},show:!0,sortable:"text",title:"Text"},{field:"count",filter:{count:"number"},show:!0,sortable:"count",title:"Count"},{field:"type",filter:{type:"text"},show:!0,sortable:"type",title:"Type"},{field:"relevance",filter:{relevance:"number"},show:!0,sortable:"relevance",title:"Relevance"},{field:"anger",filter:{anger:"number"},show:!0,sortable:"anger",title:"Anger"},{field:"disgust",filter:{disgust:"number"},show:!0,sortable:"disgust",title:"Disgust"},{field:"fear",filter:{fear:"number"},show:!0,sortable:"fear",title:"Fear"},{field:"joy",filter:{joy:"number"},show:!0,sortable:"joy",title:"Joy"},{field:"sadness",filter:{sadness:"number"},show:!0,sortable:"sadness",title:"Sadness"},{field:"sentiment",filter:{sentiment:"number"},show:!0,sortable:"sentiment",title:"Sentiment"}],u.tableParams=new t({},{dataset:m})}function s(){var e=0;f.keywords.forEach(function(t){t.text=t.text||{},t.relevance=t.relevance||{},t.emotion=t.emotion||{},t.sentiment=t.sentiment||{};var n={id:e,text:t.text,relevance:t.relevance,anger:t.emotion.anger,disgust:t.emotion.disgust,fear:t.emotion.fear,joy:t.emotion.joy,sadness:t.emotion.sadness,sentiment:t.sentiment.score};m.push(n),e++}),u.cols=[{field:"text",filter:{text:"text"},show:!0,sortable:"text",title:"Text"},{field:"relevance",filter:{relevance:"number"},show:!0,sortable:"relevance",title:"Relevance"},{field:"anger",filter:{anger:"number"},show:!0,sortable:"anger",title:"Anger"},{field:"disgust",filter:{disgust:"number"},show:!0,sortable:"disgust",title:"Disgust"},{field:"fear",filter:{fear:"number"},show:!0,sortable:"fear",title:"Fear"},{field:"joy",filter:{joy:"number"},show:!0,sortable:"joy",title:"Joy"},{field:"sadness",filter:{sadness:"number"},show:!0,sortable:"sadness",title:"Sadness"},{field:"sentiment",filter:{sentiment:"number"},show:!0,sortable:"sentiment",title:"Sentiment"}],u.tableParams=new t({},{dataset:m})}function l(){var e=0;f.relations.forEach(function(t){t.arguments=t.arguments||{},t.sentence=t.sentence||{},t.type=t.type||{},t.score=t.score||{};var n={id:e,argumentTextOne:t.arguments[0].text,sentence:t.sentence,argumentTextTwo:t.arguments[1].text,type:t.type,score:t.score};m.push(n),e++}),u.cols=[{field:"argumentTextOne",filter:{argumentTextOne:"text"},show:!0,sortable:"argumentTextOne",title:"Argument One"},{field:"sentence",filter:{sentence:"text"},show:!0,sortable:"sentence",title:"Sentence"},{field:"argumentTextTwo",filter:{argumentTextTwo:"text"},show:!0,sortable:"argumentTextTwo",title:"Argument Two"},{field:"type",filter:{type:"text"},show:!0,sortable:"type",title:"Type"},{field:"score",filter:{score:"number"},show:!0,sortable:"score",title:"Score"}],u.tableParams=new t({},{dataset:m})}function c(){var e=0;f.semanticRoles.forEach(function(t){t.sentence=t.sentence||{},t.subject=t.subject||{},t.action=t.action||{},t.object=t.object||{};var n={id:e,sentence:t.sentence,subjectText:t.subject.text,actionVerbText:t.action.verb.text,actionVerbTense:t.action.verb.tense,actionText:t.action.text,actionNormalized:t.action.normalized,objectText:t.object.text};m.push(n),e++}),u.cols=[{field:"sentence",filter:{sentence:"text"},show:!0,sortable:"sentence",title:"Sentence"},{field:"subjectText",filter:{subjectText:"text"},show:!0,sortable:"subjectText",title:"Subject Text"},{field:"actionVerbText",filter:{actionVerbText:"text"},show:!0,sortable:"actionVerbText",title:"Action Verb Text"},{field:"actionVerbTense",filter:{actionVerbTense:"text"},show:!0,sortable:"actionVerbTense",title:"Action Verb Tense"},{field:"actionText",filter:{actionText:"text"},show:!0,sortable:"actionText",title:"actionText"},{field:"actionNormalized",filter:{actionNormalized:"text"},show:!0,sortable:"actionNormalized",title:"actionNormalized"},{field:"objectText",filter:{objectText:"text"},show:!0,sortable:"objectText",title:"objectText"}],u.tableParams=new t({},{dataset:m})}var u=this,d=e.type,p=e.id,f={},m=[];u.cols=[],n.start({referenceId:"analysis-data-table"}),a.readWatsonAnalysis(p).then(function(e){switch(n.stop({referenceId:"analysis-data-table"}),f=e,d){case"categories":r();break;case"concepts":o();break;case"entities":i();break;case"keywords":s();break;case"relations":l();break;case"semantic-roles":c()}})}e.$inject=["$routeParams","NgTableParams","bsLoadingOverlayService","analysisService"],angular.module("visualisations").controller("dataTableCtrl",e)}(),function(){"use strict";function e(e,t,n){function a(e){b=d3.forceCollide(function(e){return e.radius+1}).iterations(16),y=d3.forceSimulation().force("link",d3.forceLink().id(function(e){return e.index})).force("collide",b).force("charge",d3.forceManyBody().strength(1)).force("center",d3.forceCenter(p/2,f/2)).force("y",d3.forceY(0)).force("x",d3.forceX(0));var t=d3.select("#bcPanel").append("div").attr("class","tooltip").style("opacity",0).style("background","#fff").style("padding","10px").style("border-radius","10px").style("font-weight",600);v=h.append("g").attr("class","nodes").selectAll("circle").data(e.nodes).enter().append("circle").attr("r",function(e){return e.radius}).style("cursor","pointer").on("mouseover",function(e){t.transition().duration(200).style("opacity",.9),"concepts"===l?t.html("Concept: "+e.text+"<br/>Relevance: "+d3.format(".2%")(e.relevance)+"<br/>DBpedia Resource: <a href='"+e.dbpedia_resource+"' target='_blank'>"+e.dbpedia_resource+"</a>").style("left",p/2+"px").style("transform","translate(-50%, 0)").style("top","10px").style("background","#fafafa").style("border","1px solid #000"):"keywords"===l?t.html("Keyword: "+e.text+"<br/>Relevance: "+d3.format(".2%")(e.relevance)).style("left",p/2+"px").style("transform","translate(-50%, 0)").style("top","10px").style("background","#fafafa").style("border","1px solid #000"):"entities"===l&&t.html("Entity: "+e.text+"<br/>Count: "+e.count+"<br/>Type: "+e.type+"<br/>Relevance: "+d3.format(".2%")(e.relevance)).style("left",p/2+"px").style("transform","translate(-50%, 0)").style("top","10px").style("background","#fafafa").style("border","1px solid #000")}).on("mouseout",function(e){t.transition().duration(500).delay(3e3).style("opacity",0)}).call(d3.drag().on("start",function(e){d3.event.active||y.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}).on("drag",function(e){e.fx=d3.event.x,e.fy=d3.event.y}).on("end",function(e){d3.event.active||y.alphaTarget(0),e.fx=null,e.fy=null}));var a=h.selectAll(".mytext").data(e.nodes).enter().append("text").text(function(e){return e.text}).attr("text-anchor","middle").attr("fill","#000").attr("font-family","Arial").attr("font-size",function(e){return e.radius*i.fontScale.value/50}).attr("pointer-events","none"),o=d3.scaleLinear().domain([100*g,100*m]).range([i.bubbleColour1,i.bubbleColour2]),s="translate("+(p/2-160)+","+(f-200)+")";(w=d3.select("#svg-legend").attr("width",320).attr("height",100).attr("transform",s)).append("g").attr("class","svg-legend-class").attr("width",320).attr("height",100).attr("transform","translate(0,25)");var c=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(o).title("Relevance (%)");w.select(".svg-legend-class").call(c);y.nodes(e.nodes).on("tick",function(){v.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),a.attr("x",function(e){return e.x}).attr("y",function(e){return e.y})}),r(),n.stop({referenceId:"bubble-chart"})}function r(){var e=d3.scaleLinear().domain([g,m]).range([i.bubbleColour1,i.bubbleColour2]);h.selectAll("circle").style("fill",function(t){return e(t.relevance)});var t=d3.scaleLinear().domain([100*g,100*m]).range([i.bubbleColour1,i.bubbleColour2]),n=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(t).title("Relevance (%)");w.select(".svg-legend-class").call(n)}function o(){h.selectAll("text").style("font-size",function(e){return e.radius*i.fontScale.value/50})}var i=this;document.body.scrollTop=0,document.documentElement.scrollTop=0;var s=new Slideout({panel:document.querySelector("#bcPanel"),menu:document.querySelector("#bcMenu"),padding:256,tolerance:70});i.toggleOptions=function(){s.toggle()},i.updateFontScale=o,i.setCicleColour=r,i.updateToLinearScale=function(){if("linear"===i.selectedScale){var e=d3.scaleLinear().domain([0,1]).range([0,100]),t=d3.scaleLinear().domain([g,m]).range([i.bubbleColour1,i.bubbleColour2]);h.selectAll("circle").style("fill",function(e){return t(e.relevance)}),v.each(function(t){t.radius=e(t.relevance)}).transition().duration(500).attr("r",function(e){return e.radius}),b.radius(function(e){return e.radius}),o();var n=d3.scaleLinear().domain([100*g,100*m]).range([i.bubbleColour1,i.bubbleColour2]),a=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(n).title("Relevance (%)");w.select(".svg-legend-class").call(a),y.alphaTarget(.3).restart()}},i.updateToPowScale=function(){if(i.selectedScale="power",i.powScale.value){var e=d3.scalePow().exponent(i.powScale.value).domain([0,1]).range([0,100]),t=d3.scalePow().exponent(i.powScale.value).domain([g,m]).range([i.bubbleColour1,i.bubbleColour2]);h.selectAll("circle").style("fill",function(e){return t(e.relevance)}),v.each(function(t){t.radius=e(t.relevance)}).transition().duration(500).attr("r",function(e){return e.radius}),b.radius(function(e){return e.radius}),o();var n=d3.scalePow().exponent(i.powScale.value).domain([100*g,100*m]).range([i.bubbleColour1,i.bubbleColour2]),a=d3.legendColor().shapeWidth(30).cells(10).orient("horizontal").scale(n).title("Relevance (%)");w.select(".svg-legend-class").call(a),y.alphaTarget(.3).restart()}},i.textColour="#000000",i.bubbleColour1="#e4e4d9",i.bubbleColour2="#4676fa",i.bgColour="#ffffff",i.fontScale={value:14},i.powScale={value:2},i.selectedScale="linear",i.textColourChange;var l=e.type,c=e.id,u=[],d=[],p=document.querySelector("#graph").clientWidth,f=document.querySelector("#graph").clientHeight,m=0,g=100,h=d3.select("#graph").append("svg").attr("width",p).attr("height",f).attr("class","graph-svg-component").call(d3.zoom().on("zoom",function(){h.attr("transform",d3.event.transform)})).append("g");i.circleColourOptions=[{name:"Misty Meadow",minCol:"#e4e4d9",maxCol:"#215f00"},{name:"Kyoto",minCol:"#c21500",maxCol:"#ffc500"},{name:"Pinot Noir",minCol:"#182848",maxCol:"#4b6cb7"},{name:"Miake",minCol:"#0ABFBC",maxCol:"#FC354C"},{name:"Calm Darya",minCol:"#5f2c82",maxCol:"#49a09d"},{name:"Electric Violet",minCol:"#8E54E9",maxCol:"#4776E6"},{name:"Sunrise",minCol:"#F09819",maxCol:"#FF512F"}],i.selectedCicleColour=i.circleColourOptions[0],n.start({referenceId:"bubble-chart"}),t.readWatsonAnalysis(c).then(function(e){"concepts"===l?e.concepts.forEach(function(e){var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);m=e.relevance>m?e.relevance:m,g=e.relevance<g?e.relevance:g,u.push({text:t,radius:100*e.relevance,relevance:e.relevance,dbpedia_resource:e.dbpedia_resource})}):"keywords"===l?e.keywords.forEach(function(e){var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);m=e.relevance>m?e.relevance:m,g=e.relevance<g?e.relevance:g,u.push({text:t,radius:100*e.relevance,relevance:e.relevance})}):"entities"===l&&e.entities.forEach(function(e){var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);m=e.relevance>m?e.relevance:m,g=e.relevance<g?e.relevance:g,u.push({text:t,radius:100*e.relevance,count:e.count,type:e.type,relevance:e.relevance})}),a(d={nodes:u})},function(e){n.stop({referenceId:"bubble-chart"})});var v,y,b,w;i.bgColourOptions={format:"hexString",case:"lower"},i.textColourOptions={format:"hexString",case:"lower"},i.bubbleColourOptions1={format:"hexString",case:"lower"},i.bubbleColourOptions2={format:"hexString",case:"lower"},i.bgColourChange={onChange:function(e,t){document.querySelector(".graph-svg-component").style.background=t}},i.textColourChange={onChange:function(e,t,n){h.selectAll("text").style("fill",t)}},i.bubbleColourChange1={onChange:function(){r()}},i.bubbleColourChange2={onChange:function(){r()}}}e.$inject=["$routeParams","analysisService","bsLoadingOverlayService"],angular.module("visualisations").controller("bubbleChartCtrl",e)}(),function(){function e(e,t,n,a){function r(e){console.log(e),e.forEach(function(e){for(var t=f.length,n=0;n<t;n++)f[n]===e.argumentA&&(e.common=!0),f[n]===e.argumentB&&(e.common=!0)});var t=0;p.push({name:s,group:t,weight:1}),t++,e.forEach(function(e){e.common||(p.push({name:e.argumentA,group:t,weight:e.score}),p.push({name:e.argumentB,group:t,weight:e.score}),t++)}),o(e)}function o(e){var t=[];p.forEach(function(e){t.push({source:0,target:e.group})}),p.forEach(function(e,n){n<p.length-1?t.push({source:e.group,target:p[n+1].group}):t.push({source:e.group,target:e.group})}),i(p,t)}function i(e,t){console.log(e),console.log(t);var n=d3.select("#graph").append("svg").attr("width",c).attr("height",u).attr("class","graph-svg-component").call(d3.zoom().on("zoom",function(){n.attr("transform",d3.event.transform)})).append("g"),a=d3.forceSimulation().force("link",d3.forceLink()).force("charge",d3.forceManyBody().strength(-850)).force("center",d3.forceCenter(c/2,u/2));t.forEach(function(e){e.source=e.source,e.target=e.target});var r=n.append("g").style("stroke","#aaa").selectAll("line").data(t).enter().append("line"),o=n.append("g").attr("class","nodes").selectAll("circle").data(e).enter().append("circle").attr("r",6).call(d3.drag().on("start",function(e){d3.event.active||a.alphaTarget(.3).restart()}).on("drag",function(e){}).on("end",function(e){d3.event.active||a.alphaTarget(0)})),i=n.append("g").attr("class","labels").selectAll("text").data(e).enter().append("text").attr("class","label").text(function(e){return e.name});a.nodes(e).on("tick",function(){r.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),o.attr("r",20).style("fill","#d9d9d9").style("stroke","#969696").style("stroke-width","1px").attr("cx",function(e){return e.x+6}).attr("cy",function(e){return e.y-6}),i.attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).style("font-size","14px").style("fill","#4393c3")}),a.force("link").links(t)}this.toggleOptions=function(){m.toggle()};e.type;var s,l=e.id,c=document.querySelector("#graph").clientWidth,u=document.querySelector("#graph").clientHeight,d=[],p=[],f=["he","she","the","of","and","a","to","in","is","you","that","it","was","for","on","are","as","with","his","they","I","at","be","this","have","from","or","one","had","by","word","but","not","what","all","where","your","can","said","there","use","an","each","which","do","how","their","if","will","Mr","Ms","one","two","man","boy","her","Mr","Mr.","Mrs","Mrs.","me","him","He","Her","Their"],m=new Slideout({panel:document.querySelector("#netPanel"),menu:document.querySelector("#netMenu"),padding:256,tolerance:70});a.start({referenceId:"network-chart"}),t.readWatsonAnalysis(l).then(function(e){s=e.name;var t=0;e.relations.forEach(function(e){e.arguments=e.arguments||{},e.score=e.score||{};var n={id:t,argumentA:e.arguments[0].text,argumentB:e.arguments[1].text,score:e.score,common:!1};d.push(n),t++}),r(d)},function(e){a.stop({referenceId:"network-chart"})})}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("visualisations").controller("networkChartCtrl",e)}(),function(){function e(e,t){function n(e,t){var n={w:600,h:600,margin:{top:20,right:20,bottom:20,left:20},levels:3,maxValue:0,labelFactor:1.25,wrapWidth:60,opacityArea:.35,dotRadius:4,opacityCircles:.1,strokeWidth:2,roundStrokes:!1,color:d3.schemeCategory10};if(void 0!==t)for(var r in t)void 0!==t[r]&&(n[r]=t[r]);var o=Math.max(n.maxValue,d3.max(a.data,function(e){return d3.max(e.map(function(e){return e.value}))})),i=a.data[0].map(function(e,t){return e.axis}),s=i.length,l=Math.min(n.w/2,n.h/2),c=d3.format("%"),u=2*Math.PI/s,d=d3.scaleLinear().range([0,l]).domain([0,o]);d3.select(e).select("svg").remove();var p=d3.select(e).append("svg").attr("width",n.w+n.margin.left+n.margin.right).attr("height",n.h+n.margin.top+n.margin.bottom).attr("class","radar"+e).append("g").attr("transform","translate("+(n.w/2+n.margin.left)+","+(n.h/2+n.margin.top)+")"),f=p.append("defs").append("filter").attr("id","glow"),m=(f.append("feGaussianBlur").attr("stdDeviation","2.5").attr("result","coloredBlur"),f.append("feMerge")),g=(m.append("feMergeNode").attr("in","coloredBlur"),m.append("feMergeNode").attr("in","SourceGraphic"),p.append("g").attr("class","axisWrapper"));g.selectAll(".levels").data(d3.range(1,n.levels+1).reverse()).enter().append("circle").attr("class","gridCircle").attr("r",function(e,t){return l/n.levels*e}).style("fill","#CDCDCD").style("stroke","#CDCDCD").style("fill-opacity",n.opacityCircles).style("filter","url(#glow)"),g.selectAll(".axisLabel").data(d3.range(1,n.levels+1).reverse()).enter().append("text").attr("class","axisLabel").attr("x",4).attr("y",function(e){return-e*l/n.levels}).attr("dy","0.4em").style("font-size","10px").attr("fill","#737373").text(function(e,t){return c(o*e/n.levels)});var h=g.selectAll(".axis").data(i).enter().append("g").attr("class","axis");h.append("line").attr("x1",0).attr("y1",0).attr("x2",function(e,t){return d(1.1*o)*Math.cos(u*t-Math.PI/2)}).attr("y2",function(e,t){return d(1.1*o)*Math.sin(u*t-Math.PI/2)}).attr("class","line").style("stroke","white").style("stroke-width","2px"),h.append("text").attr("class","legend").style("font-size","11px").attr("text-anchor","middle").attr("dy","0.35em").attr("x",function(e,t){return d(o*n.labelFactor)*Math.cos(u*t-Math.PI/2)}).attr("y",function(e,t){return d(o*n.labelFactor)*Math.sin(u*t-Math.PI/2)}).text(function(e){return e}).call(function(e,t){e.each(function(){for(var e,n=d3.select(this),a=n.text().split(/\s+/).reverse(),r=[],o=0,i=n.attr("y"),s=n.attr("x"),l=parseFloat(n.attr("dy")),c=n.text(null).append("tspan").attr("x",s).attr("y",i).attr("dy",l+"em");e=a.pop();)r.push(e),c.text(r.join(" ")),c.node().getComputedTextLength()>t&&(r.pop(),c.text(r.join(" ")),r=[e],c=n.append("tspan").attr("x",s).attr("y",i).attr("dy",1.4*++o+l+"em").text(e))})},n.wrapWidth);var v=d3.radialLine().curve(d3.curveLinearClosed).radius(function(e){return d(e.value)}).angle(function(e,t){return t*u});n.roundStrokes&&v.curve(d3.curveCardinalClosed);var y=p.selectAll(".radarWrapper").data(a.data).enter().append("g").attr("class","radarWrapper");y.append("path").attr("class","radarArea").attr("d",function(e,t){return v(e)}).style("fill",function(e,t){return n.color(t)}).style("fill-opacity",n.opacityArea).on("mouseover",function(e,t){d3.selectAll(".radarArea").transition().duration(200).style("fill-opacity",.1),d3.select(this).transition().duration(200).style("fill-opacity",.7),b.text(e[0].text).transition().duration(200).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".radarArea").transition().duration(200).style("fill-opacity",n.opacityArea),b.transition().duration(200).style("opacity",0)});b=p.append("text").attr("class","tooltip").style("opacity",0);y.append("path").attr("class","radarStroke").attr("d",function(e,t){return v(e)}).style("stroke-width",n.strokeWidth+"px").style("stroke",function(e,t){return n.color(t)}).style("fill","none").style("filter","url(#glow)"),y.selectAll(".radarCircle").data(function(e,t){return e}).enter().append("circle").attr("class","radarCircle").attr("r",n.dotRadius).attr("cx",function(e,t){return d(e.value)*Math.cos(u*t-Math.PI/2)}).attr("cy",function(e,t){return d(e.value)*Math.sin(u*t-Math.PI/2)}).style("fill",function(e,t,a){return n.color(a)}).style("fill-opacity",.8),p.selectAll(".radarCircleWrapper").data(a.data).enter().append("g").attr("class","radarCircleWrapper").selectAll(".radarInvisibleCircle").data(function(e,t){return e}).enter().append("circle").attr("class","radarInvisibleCircle").attr("r",1.5*n.dotRadius).attr("cx",function(e,t){return d(e.value)*Math.cos(u*t-Math.PI/2)}).attr("cy",function(e,t){return d(e.value)*Math.sin(u*t-Math.PI/2)}).style("fill","none").style("pointer-events","all").on("mouseover",function(e,t){newX=parseFloat(d3.select(this).attr("cx"))-10,newY=parseFloat(d3.select(this).attr("cy"))-10,b.attr("x",newX).attr("y",newY).text(c(e.value)).transition().duration(200).style("opacity",1)}).on("mouseout",function(){b.transition().duration(200).style("opacity",0)});var b=p.append("text").attr("class","tooltip").style("opacity",0)}var a=this;document.body.scrollTop=0,document.documentElement.scrollTop=0;var r=e.type,o=e.id;a.updateRadarChart=function(){a.data=[],a.analysisData.forEach(function(e){e.checked&&a.data.push(e)}),0===a.data.length?d3.select(".radarChart").select("svg").remove():n(".radarChart",c)},a.toggleOptions=function(){i.toggle()},a.toogleAllBoxes=function(){a.selectAll?a.analysisData.forEach(function(e){e.checked=!0,a.data.push(e)}):(a.analysisData.forEach(function(e){e.checked=!1}),a.data=[]),0===a.data.length?d3.select(".radarChart").select("svg").remove():n(".radarChart",c)},a.analysisData=[],a.data=[],a.selectAll=!1;var i=new Slideout({panel:document.querySelector("#rcPanel"),menu:document.querySelector("#rcMenu"),padding:256,tolerance:70});t.readWatsonAnalysis(o).then(function(e){"entities"===r?e.entities.forEach(function(e){if(e.emotion){var t=[{axis:"Anger",value:e.emotion.anger,text:e.text},{axis:"Disgust",value:e.emotion.disgust},{axis:"Fear",value:e.emotion.fear},{axis:"Joy",value:e.emotion.joy},{axis:"Sadness",value:e.emotion.sadness}];a.analysisData.push(t)}}):"keywords"===r&&e.keywords.forEach(function(e){if(e.emotion){var t=[{axis:"Anger",value:e.emotion.anger,text:e.text},{axis:"Disgust",value:e.emotion.disgust},{axis:"Fear",value:e.emotion.fear},{axis:"Joy",value:e.emotion.joy},{axis:"Sadness",value:e.emotion.sadness}];a.analysisData.push(t)}}),a.analysisData[0].checked=!0,a.data.push(a.analysisData[0]),n(".radarChart",c)});var s={top:100,right:100,bottom:100,left:100},l=Math.min(700,window.innerWidth-10)-s.left-s.right,c={w:l,h:Math.min(l,window.innerHeight-s.top-s.bottom-20),margin:s,maxValue:.5,levels:5,roundStrokes:!0,color:d3.scaleOrdinal().range(["#EDC951","#CC333F","#00A0B0"])}}e.$inject=["$routeParams","analysisService"],angular.module("visualisations").controller("radarChartCtrl",e)}(),function(){function e(e,t,n,a){function r(){d.length>10?(sortData=d.slice(d.length-10,d.length),sortData.reverse(),i(sortData)):(d.reverse(),i(d))}function o(){d.sort(function(e,t){return e.relevance-t.relevance})}function i(e){var t=0,n=[],a=0;e.forEach(function(e){t+=e.relevance,n[a]=e.relevance,a++}),a=0,e.forEach(function(e){n[a]=t/e.relevance,e.relevance=n[a],a++}),s(e)}function s(e){console.log(f/4),console.log(m/2.5),g=v.append("g").attr("transform","translate("+f/4+","+m/2+")");var t=d3.select("#piePanel").append("div").attr("class","pie-chart-tooltip").style("opacity",0).style("background","#fff").style("padding","10px").style("border-radius","10px").style("font-weight",600),n=d3.scaleOrdinal(d3.schemeCategory20c),a=d3.pie().sort(null).value(function(e){return e.relevance}),r=h-100,o=d3.arc().outerRadius(r).innerRadius(0),i=d3.arc().outerRadius(h-120).innerRadius(h-120),s=g.selectAll(".arc").data(a(e)).enter().append("g").attr("class","arc").attr("transform","translate("+r+",0)").on("mousemove",function(e){t.transition().duration(200).style("opacity",.9),t.html(e.data.text+"<br>"+d3.format(".2%")(e.data.relevance/100)).style("left",f/2+"px").style("transform","translate(-50%, 0)").style("top","10px").style("background","#fafafa").style("border","1px solid #000")}).on("mouseout",function(e){t.transition().duration(500).delay(3e3).style("opacity",0)});s.append("path").attr("d",o).attr("fill",function(e){return n(e.data.text)}),s.append("text").attr("transform",function(e){return"translate("+i.centroid(e)+")"}).attr("dy","0.35em").text(function(e){return e.data.text})}var l=this,c=e.type,u=e.id,d=[];a.start({referenceId:"pie-chart"}),t.readWatsonAnalysis(u).then(function(e){switch(c){case"concepts":e.concepts.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);d.push({relevance:e.relevance,text:t,dbpedia_resource:e.dbpedia_resource})}),o(),r();break;case"keywords":e.keywords.forEach(function(e){e.relevance;var t=e.text.charAt(0).toUpperCase()+e.text.slice(1);d.push({relevance:e.relevance,text:t})}),o(),r()}},function(e){a.stop({referenceId:"bubble-chart"})});var p=new Slideout({panel:document.querySelector("#piePanel"),menu:document.querySelector("#pieMenu"),padding:256,tolerance:70});l.toggleOptions=function(){p.toggle()};var f=document.querySelector("#chart").clientWidth,m=document.querySelector("#chart").clientHeight,h=Math.min(f,m)/2,v=d3.select("#chart").append("svg").attr("width",f).attr("height",m).attr("radius",h).attr("class","chart-svg-component").call(d3.zoom().scaleExtent([.5,10]).translateExtent([[-f/2,-m/2],[1.5*f,1.5*m]]).on("zoom",function(){v.attr("transform",d3.event.transform)})).append("g")}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("visualisations").controller("pieChartCtrl",e)}(),function(){function e(e,t,n,a){function r(e){e.categories.forEach(function(e){var t=50*e.score,n=e.label.toUpperCase();b=t>b?t:b,w=t<w?t:w,h.push({text:n,size:t})}),l()}function o(e){e.concepts.forEach(function(e){var t=50*e.relevance,n=e.text.toUpperCase();b=t>b?t:b,w=t<w?t:w,h.push({text:n,size:t})}),l()}function i(e){e.entities.forEach(function(e){var t=50*e.relevance,n=e.text.toUpperCase();b=t>b?t:b,w=t<w?t:w,h.push({text:n,size:t})}),l()}function s(e){e.keywords.forEach(function(e){var t=50*e.relevance,n=e.text.toUpperCase();b=t>b?t:b,w=t<w?t:w,h.push({text:n,size:t})}),l()}function l(){var e,t,n=["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateRainbow","interpolateCubehelixDefault"],r=d3.scaleSequential(d3[n[c(0,8)]]),o=[];angular.copy(h,o),"power"===d.selectedScale?(t=d3.scalePow().exponent(d.sizes.powScale).domain([w,b]).range([d.sizes.minFont,d.sizes.maxFont]),e=d3.scalePow().exponent(d.sizes.powScale).domain([t(w),t(b)]).range([d.wordColour1,d.wordColour2])):(t=d3.scaleLinear().domain([w,b]).range([d.sizes.minFont,d.sizes.maxFont]),e=d3.scaleLinear().domain([t(w),t(b)]).range([d.wordColour1,d.wordColour2])),d3.layout.cloud().size([v,y]).words(o).rotate(0).text(function(e){return e.text}).font("Impact").fontSize(function(e){return t(e.size)}).on("end",function(t){var n=d3.zoom().on("zoom",function(){x=d3.event.transform.x,k=d3.event.transform.y,L=d3.event.transform.k,a.attr("transform",d3.event.transform)}),a=(g=d3.select("div.svg-container").append("svg").attr("width",v).attr("height",y).attr("class","wordcloud").call(n)).append("g");a.attr("transform","translate("+x+", "+k+") scale("+L+")").selectAll("text").data(t).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family","Impact").style("fill",function(t,n){return d.rainbow?r(Math.random()):e(t.size)}).style("cursor","default").style("stroke",function(){return d.stroke?"black":"none"}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x*d.sizes.wordSpacingFactor,e.y*d.sizes.wordSpacingFactor]+")"}).text(function(e){return e.text}),g.call(n.transform,d3.zoomIdentity.translate(x,k).scale(L))}).start(),a.stop({referenceId:"word-cloud"})}function c(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}function u(){d.rainbow=!1;var e,t;"power"===d.selectedScale?(t=d3.scalePow().exponent(d.sizes.powScale).domain([w,b]).range([d.sizes.minFont,d.sizes.maxFont]),e=d3.scalePow().exponent(d.sizes.powScale).domain([t(w),t(b)]).range([d.wordColour1,d.wordColour2])):(t=d3.scaleLinear().domain([w,b]).range([d.sizes.minFont,d.sizes.maxFont]),e=d3.scaleLinear().domain([t(w),t(b)]).range([d.wordColour1,d.wordColour2])),g.selectAll("text").style("fill",function(t){return e(t.size)})}var d=this,p=e.type,f=e.id;document.body.scrollTop=0,document.documentElement.scrollTop=0;var m=new Slideout({panel:document.querySelector("#wcPanel"),menu:document.querySelector("#wcMenu"),padding:256,tolerance:70});d.toggleOptions=function(){m.toggle()},d.updateChart=function(){d3.selectAll("div.svg-container > *").remove(),l()},d.wordColour1="#a5a5a5",d.wordColour2="#4676fa",d.wordColourOptions1={format:"hexString",case:"lower"},d.wordColourOptions2={format:"hexString",case:"lower"},d.wordColourChange1={onChange:function(){u()}},d.wordColourChange2={onChange:function(){u()}},d.selectedScale="linear",d.rainbow=!1,d.stroke=!1,d.sizes={wordSpacingFactor:1,powScale:2,minFont:14,maxFont:60};var g,h=[],v=document.querySelector(".svg-container").clientWidth,y=document.querySelector(".svg-container").clientHeight,b=0,w=100,x=v/2,k=y/2,L=1;a.start({referenceId:"word-cloud"}),t.readWatsonAnalysis(f).then(function(e){switch(p){case"categories":r(e);break;case"concepts":o(e);break;case"entities":i(e);break;case"keywords":s(e)}},function(e){a.stop({referenceId:"word-cloud"})})}e.$inject=["$routeParams","analysisService","NgTableParams","bsLoadingOverlayService"],angular.module("visualisations").controller("wordCloudCtrl",e)}();